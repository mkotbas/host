<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Denetim Formu (Bulut Destekli)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>

    <style>
        :root {
            --primary: #008CBA; --primary-dark: #007B9A; --secondary: #64748b; --success: #16a34a; --success-light: #dcfce7; --warning: #eab308; --danger: #dc2626; --light: #f8fafc; --dark: #1e293b; --gray: #94a3b8; --border: #e2e8f0; --card-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); --transition: all 0.3s ease;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; font-size: 14px; line-height: 1.6; color: var(--dark); background-color: #f1f5f9; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; }
        .card { background: white; border-radius: 12px; box-shadow: var(--card-shadow); padding: 24px; margin-bottom: 24px; transition: var(--transition); }
        h2 { font-size: 20px; color: var(--primary); border-bottom: 2px solid var(--border); padding-bottom: 10px; margin-bottom: 20px; }
        button, .btn-like-label { cursor: pointer; border: none; border-radius: 8px; padding: 10px 16px; font-weight: 600; transition: var(--transition); display: inline-flex; align-items: center; justify-content: center; }
        button:disabled { background-color: var(--gray) !important; color: #fff !important; cursor: not-allowed; opacity: 0.7; }
        button i, .btn-like-label i { margin-right: 8px; }
        .btn-primary { background-color: var(--primary); color: white; }
        .btn-success { background-color: var(--success); color: white; }
        .btn-danger { background-color: var(--danger); color: white; }
        .btn-warning { background-color: var(--warning); color: var(--dark); }
        .btn-sm { padding: 6px 12px; font-size: 12px; }
        .action-button { width: 100%; padding: 12px; font-size: 15px; margin: 10px 0 30px; border-radius: 10px; background-color: var(--primary); color: white; }
        .fide-item { margin-bottom: 28px; padding: 20px; border-radius: 12px; background-color: white; box-shadow: var(--card-shadow); transition: var(--transition); }
        .fide-item.question-removed { opacity: 0.6; background-color: #fafafa; }
        .fide-title-container { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; padding-bottom: 12px; border-bottom: 1px solid var(--border); flex-wrap: wrap; gap: 10px;}
        .fide-title-container p { font-weight: 600; margin: 0; flex-grow: 1; font-size: 16px; color: var(--dark); }
        .fide-title-container.question-completed p { color: var(--success); text-decoration: line-through; }
        .fide-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--border); }
        .badge { display: inline-block; padding: 4px 10px; border-radius: 20px; font-size: 12px; font-weight: 600; margin-right: 8px; background-color: var(--primary); color: white; }
        .static-item, .dynamic-input-item { display: flex; align-items: center; margin-bottom: 12px; padding: 12px; background-color: var(--light); border-radius: 8px; transition: all 0.3s ease; overflow: hidden; }
        .static-item .content { flex-grow: 1; transition: all 0.3s ease; }
        .dynamic-input-item input[type="text"] { flex-grow: 1; border: 1px solid var(--border); padding: 10px; border-radius: 6px; transition: all 0.3s ease;}
        .dynamic-input-item input[type="text"].completed { text-decoration: line-through; color: var(--success); background-color: var(--success-light); }
        .add-item-btn { background-color: var(--primary); color: white; }
        .status-btn { background-color: var(--success); color: white; margin-left: 10px; }
        .status-btn.undo { background-color: var(--warning); color: var(--dark); }
        .delete-bar { flex-shrink: 0; width: 32px; border-radius: 0 8px 8px 0; cursor: pointer; align-self: stretch; display: flex; align-items: center; justify-content: center; margin: -12px -12px -12px 15px; padding: 12px 0; }
        .file-input-wrapper { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-top: 1rem; }
        .file-input-wrapper input[type="file"] { display: none; }
        .file-input-label { background-color: var(--primary); color: white; padding: 6px 12px; font-size: 12px; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; transition: var(--transition); }
        .file-input-label i { margin-right: 8px; }
        #file-name, #fide-file-name { font-style: italic; color: var(--dark); }
        #store-selection-area { display: none; margin-top: 20px; }
        #store-search-input { width: 100%; padding: 12px; border: 1px solid var(--border); border-radius: 6px; margin-bottom: 12px; font-size: 16px; }
        #store-list { max-height: 250px; overflow-y: auto; border: 1px solid var(--border); border-radius: 6px; padding: 5px; }
        .store-item { padding: 10px; cursor: pointer; border-radius: 4px; margin-bottom: 4px; }
        .store-item:hover { background-color: #f1f5f9; }
        .store-item.selected { background-color: var(--success); color: white; font-weight: bold; }
        #clear-storage-btn, #clear-excel-btn, #clear-fide-excel-btn { display: none; }
        #initialization-error { display: none; color: #b91c1c; background-color: #fee2e2; border: 1px solid #f87171; }
        .top-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; flex-wrap: wrap; gap: 10px; }
        .backup-controls { display: flex; gap: 8px; flex-wrap: wrap; }
        
        /* --- YENİ TOGGLE SWITCH STİLLERİ --- */
        .cloud-toggle-container { display: flex; align-items: center; gap: 10px; font-size: 12px; font-weight: 600;}
        .switch { position: relative; display: inline-block; width: 44px; height: 24px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--danger); transition: .4s; border-radius: 24px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--success); }
        input:checked + .slider:before { transform: translateX(20px); }
    </style>
</head>
<body>
    <div class="container">
        <div class="top-controls">
            <div class="backup-controls">
                <button id="backup-btn" class="btn-primary btn-sm"><i class="fas fa-cloud-download-alt"></i> Tüm Raporları Yedekle</button>
                <label for="restore-file-input" class="btn-like-label btn-success btn-sm"><i class="fas fa-cloud-upload-alt"></i> Yedekten Yükle</label>
                <input type="file" id="restore-file-input" accept=".json" style="display: none;">
                <label for="merge-file-input" class="btn-like-label btn-warning btn-sm"><i class="fas fa-compress-arrows-alt"></i> Yedekleri Birleştir</label>
                <input type="file" id="merge-file-input" accept=".json" style="display: none;" multiple>
            </div>
            <div class="cloud-toggle-container">
                <span id="cloud-status-text">Bulut Kapalı</span>
                <label class="switch">
                    <input type="checkbox" id="cloud-toggle" checked>
                    <span class="slider"></span>
                </label>
            </div>
            <button id="toggle-manager-btn" class="btn-warning btn-sm"><i class="fas fa-edit"></i> Soru Yöneticisi</button>
        </div>
        
        <div class="card" id="question-manager" style="display: none;">
            <h2><i class="fas fa-cogs"></i> FiDe Soru Yöneticisi</h2>
            <p style="font-size: 12px; color: var(--secondary); margin-top: -15px; margin-bottom: 15px;"><i class="fas fa-info-circle"></i> Buradan FİDE sorularını düzenleyin...</p>
            <div class="manager-actions">
                <button onclick="saveQuestions()" class="btn-success"><i class="fas fa-save"></i> Değişiklikleri Kaydet ve Dosyayı İndir</button>
                <button onclick="addNewQuestionUI()" class="btn-primary"><i class="fas fa-plus"></i> Yeni Soru Ekle</button>
            </div>
            <div id="manager-list"></div>
        </div>

        <div class="card" id="dide-upload-card">
            <h2><i class="fas fa-chart-line"></i> Puan Entegrasyonu ve Veri Yönetimi</h2>
            <p style="font-size: 12px; color: var(--secondary); margin-top: -15px; margin-bottom: 15px;"><i class="fas fa-info-circle"></i> Raporlarınız artık bulutta saklanıyor. Manuel yedekleme butonları ek güvenlik için korunmuştur.</p>
            <div>
                <p><b>1. Adım: DiDe Puan Excel Dosyasını Yükleyin</b></p>
                <div class="file-input-wrapper"><label for="excel-file-input" class="file-input-label btn-sm"><i class="fas fa-file-excel"></i> DiDe Excel'i Seç</label><input type="file" id="excel-file-input" accept=".xlsx, .xls" style="display: none;"><span id="file-name">Henüz dosya seçilmedi.</span></div>
            </div>
            <div style="margin-top: 20px;">
                <p><b>2. Adım: FiDe Puan Excel Dosyasını Yükleyin</b></p>
                <div class="file-input-wrapper"><label for="fide-excel-file-input" class="file-input-label btn-sm"><i class="fas fa-file-excel"></i> FiDe Excel'i Seç</label><input type="file" id="fide-excel-file-input" accept=".xlsx, .xls" style="display: none;"><span id="fide-file-name">Henüz dosya seçilmedi.</span></div>
            </div>
            <div style="margin-top: 20px;">
                <p><b>3. Adım: Rapor ve Veri Temizleme</b></p>
                <div class="file-input-wrapper">
                    <button id="clear-storage-btn" class="btn-danger btn-sm"><i class="fas fa-eraser"></i> Tüm Raporları Sil</button>
                    <button id="clear-excel-btn" class="btn-danger btn-sm"><i class="fas fa-trash-alt"></i> DiDe Excell'i Sil</button>
                    <button id="clear-fide-excel-btn" class="btn-danger btn-sm"><i class="fas fa-trash-alt"></i> FiDe Excell'i Sil</button>
                </div>
            </div>
            <div id="store-selection-area" style="display:none;"><hr style="margin: 20px 0;"><p><b>4. Adım: Denetlenecek Bayiyi Arayın ve Seçin</b></p><button id="new-report-btn" class="btn-warning btn-sm" style="margin-bottom: 10px; width: 100%;"><i class="fas fa-file"></i> Yeni Rapor / Formu Temizle</button><input type="text" id="store-search-input" placeholder="Bayi adı veya kodu ile aramaya başlayın..."><div id="store-list"></div></div>
        </div>
        
        <div class="card" id="load-section">
            <h2><i class="fas fa-download"></i> Önceki Bir Fide Raporunu Yükle (Manuel)</h2>
            <p style="margin-bottom: 8px;">Daha önce kaydettiğiniz "Rapor Kodu"nu buraya yapıştırın...</p>
            <textarea id="load-code-area" placeholder="Rapor kodunuzu bu alana yapıştırın..."></textarea>
            <button class="btn-primary" onclick="loadReport()"><i class="fas fa-cloud-download-alt"></i> Raporu Yükle</button>
        </div>

        <div class="card" id="initialization-error" style="display: none;"><h2><i class="fas fa-exclamation-triangle"></i> Başlatma Hatası</h2><p><b><code>fide_soru_listesi.json</code></b> dosyası bulunamadı veya okunamadı.</p></div>
        <div id="form-content"></div>
        <button class="action-button" onclick="generateEmail()"><i class="fas fa-envelope"></i> E-POSTA TASLAĞI OLUŞTUR</button>
        <div class="card" id="save-section" style="display: none;"><h2><i class="fas fa-save"></i> YEDEKLEME İÇİN RAPOR KODU</h2><p>Bu rapor hem buluta hem de tarayıcınıza otomatik olarak kaydedildi.</p><textarea id="save-code-area" readonly></textarea><button class="btn-success" id="download-report-btn" onclick="downloadReportCode()"><i class="fas fa-download"></i> Rapor Kodunu İndir (.txt)</button></div>
    </div>

    <script>
    // --- FIREBASE YAPILANDIRMASI ---
    const firebaseConfig = {
      apiKey: "AIzaSyCvUBeaqFSlbLsDd0zkwEoEj0sXet1wVq8",
      authDomain: "fide-denetim-sistemi.firebaseapp.com",
      databaseURL: "https://fide-denetim-sistemi-default-rtdb.firebaseio.com/",
      projectId: "fide-denetim-sistemi",
      storageBucket: "fide-denetim-sistemi.firebasestorage.app",
      messagingSenderId: "733807364443",
      appId: "1:733807364443:web:2dd374967cf110cb87f27e"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();
    let currentUser = null;
    
    // --- GLOBAL DEĞİŞKENLER ---
    let dideData = [], fideData = [], uniqueStores = [], selectedStore = null, fideQuestions = [], popCodes = [], expiredCodes = [], productList = [], expiredExcelFiles = [];
    let isStoreSelected = false;
    let isCloudSyncEnabled = true; // YENİ: Bulut senkronizasyonunu kontrol eder
    const fallbackFideQuestions = [ { id: 0, type: 'standard', title: "HATA: fide_soru_listesi.json dosyası yüklenemedi. Lütfen dosyayı kontrol edin." } ];
    const monthNames = ["", "Ocak", "Şubat", "Mart", "Nisan", "Mayıs", "Haziran", "Temmuz", "Ağustos", "Eylül", "Ekim", "Kasım", "Aralık"];

    // --- TÜM FONKSİYONLAR (EKSİKSİZ VE DOĞRU) ---
    function updateCloudStatusText(isConnected) { const textEl = document.getElementById('cloud-status-text'); if(textEl) { textEl.textContent = isConnected ? 'Bulut Aktif' : 'Bulut Kapalı'; } }
    async function saveDataToFirebase() { if (!currentUser || !isCloudSyncEnabled) return; const allReports = localStorage.getItem('allFideReports'); if (allReports) { try { await db.ref(`users/${currentUser.uid}/allFideReports`).set(JSON.parse(allReports)); } catch (error) { console.error("Firebase'e yazma hatası:", error); alert("Buluta kayıt sırasında hata oluştu!"); } } }
    function saveFormState() { if (!document.getElementById('form-content').innerHTML || !selectedStore) return; let allReports = JSON.parse(localStorage.getItem('allFideReports')) || {}; const reportData = getFormDataForSaving(); const storeKey = `store_${selectedStore.bayiKodu}`; allReports[storeKey] = { timestamp: new Date().getTime(), data: reportData }; localStorage.setItem('allFideReports', JSON.stringify(allReports)); saveDataToFirebase(); }
    function getFormDataForSaving() { let reportData = { selectedStore: selectedStore, questions_status: {} }; fideQuestions.forEach(q => { const itemDiv = document.getElementById(`fide-item-${q.id}`); if(!itemDiv) return; const isRemoved = itemDiv.classList.contains('question-removed'); const titleContainer = itemDiv.querySelector('.fide-title-container'); const isCompleted = titleContainer ? titleContainer.classList.contains('question-completed') : false; const questionData = { removed: isRemoved, completed: isCompleted, dynamicInputs: [], selectedProducts: [], selectedPops: [] }; if (q.type === 'standard') { const container = document.getElementById(`sub-items-container-fide${q.id}`); if(container) { questionData.dynamicInputs = Array.from(container.querySelectorAll('.dynamic-input-item:not(.is-deleting)')).map(node => ({ text: node.querySelector('input').value.trim(), completed: node.querySelector('input').classList.contains('completed') })).filter(item => item.text); } } else if (q.type === 'product_list') { questionData.selectedProducts = Array.from(document.querySelectorAll('#selected-products-list .selected-product-item')).map(item => ({ id: item.dataset.id, qty: item.dataset.qty })); const pleksiContainer = document.getElementById('sub-items-container-fide15_pleksi'); if(pleksiContainer) { questionData.dynamicInputs = Array.from(pleksiContainer.querySelectorAll('.dynamic-input-item:not(.is-deleting)')).map(node => ({ text: node.querySelector('input').value.trim(), completed: node.querySelector('input').classList.contains('completed') })).filter(item => item.text); } } reportData.questions_status[q.id] = questionData; }); return reportData; }
    function getUnitForProduct(productName) { const upperCaseName = productName.toUpperCase(); if (upperCaseName.includes('TSHIRT') || upperCaseName.includes('HIRKA')) { return 'Adet'; } return 'Paket'; }
    function resetForm() { document.getElementById('form-content').innerHTML = ''; buildForm(); }
    function buildForm() { const formContainer = document.getElementById('form-content'); formContainer.innerHTML = ''; let html = ''; fideQuestions.forEach(q => { const disabledState = isStoreSelected ? '' : 'disabled'; let questionActionsHTML = ''; let questionContentHTML = ''; if (q.type === 'standard') { questionActionsHTML = `<div class="fide-actions"><button class="add-item-btn btn-sm btn-primary" onclick="addDynamicInput('fide${q.id}')" ${disabledState}><i class="fas fa-plus"></i> Yeni Eksik Ekle</button><button class="status-btn btn-sm btn-success" onclick="toggleQuestionCompleted(this, ${q.id})" ${disabledState}><i class="fas fa-check"></i> Tamamlandı</button><button class="remove-btn btn-danger btn-sm" onclick="toggleQuestionRemoved(this, ${q.id})" ${disabledState}><i class="fas fa-times-circle"></i> Çıkar</button></div>`; let staticItemsHTML = (q.staticItems || []).map(item => `<div class="static-item"><div class="content">${item}</div><button class="delete-bar btn-danger" onclick="initiateDeleteItem(this)" ${disabledState}><i class="fas fa-trash"></i></button></div>`).join(''); questionContentHTML = `<div class="input-area"><div id="sub-items-container-fide${q.id}">${staticItemsHTML}</div></div>`; } else if (q.type === 'product_list') { questionActionsHTML = `<div class="fide-actions"><button class="add-item-btn btn-sm btn-primary" onclick="addDynamicInput('fide15_pleksi')" ${disabledState}><i class="fas fa-plus"></i> Yeni Ekle</button><button class="status-btn btn-sm btn-success" onclick="toggleQuestionCompleted(this, ${q.id})" ${disabledState}><i class="fas fa-check"></i> Tamamlandı</button><button class="remove-btn btn-danger btn-sm" onclick="toggleQuestionRemoved(this, ${q.id})" ${disabledState}><i class="fas fa-times-circle"></i> Çıkar</button></div>`; let productOptions = ''; let currentOptgroup = false; productList.forEach(p => { if (p.type === 'header') { if (currentOptgroup) productOptions += `</optgroup>`; productOptions += `<optgroup label="${p.name}">`; currentOptgroup = true; } else { productOptions += `<option value="${p.id}">${p.code} - ${p.name}</option>`; } }); if (currentOptgroup) productOptions += `</optgroup>`; questionContentHTML = `<div class="input-area"><b><i>Sipariş verilmesi gerekenler:</i></b><div class="product-adder"><select id="product-selector" ${disabledState}><option value="">-- Malzeme Seçin --</option>${productOptions}</select><input type="number" id="product-qty" placeholder="Adet" min="1" value="1" ${disabledState}><button class="btn-success btn-sm" onclick="addProductToList()" ${disabledState}><i class="fas fa-plus"></i> Ekle</button></div><div id="selected-products-list"></div><hr><b><i>Pleksiyle ilgili notlar:</i></b><div id="sub-items-container-fide15_pleksi"></div></div>`; } html += `<div class="fide-item" id="fide-item-${q.id}"><div class="fide-title-container"><p><span class="badge">FiDe ${q.id}</span> ${q.title}</p></div>${questionContentHTML}${questionActionsHTML}</div>`; }); formContainer.innerHTML = html; }
    function initiateDeleteItem(buttonEl) { const itemEl = buttonEl.parentElement; if (itemEl.classList.contains('is-deleting')) { clearTimeout(itemEl.dataset.deleteTimer); itemEl.removeAttribute('data-delete-timer'); itemEl.classList.remove('is-deleting'); buttonEl.querySelector('i').className = 'fas fa-trash'; buttonEl.classList.remove('btn-warning'); buttonEl.classList.add('btn-danger'); } else { itemEl.classList.add('is-deleting'); buttonEl.querySelector('i').className = 'fas fa-undo'; buttonEl.classList.remove('btn-danger'); buttonEl.classList.add('btn-warning'); const timerId = setTimeout(() => { itemEl.remove(); saveFormState(); }, 4000); itemEl.dataset.deleteTimer = timerId; } saveFormState(); }
    function addProductToList(productId, quantity) { const select = document.getElementById('product-selector'); const qtyInput = document.getElementById('product-qty'); const selectedProductId = productId || select.value; const selectedQty = quantity || qtyInput.value; if (!selectedProductId || !selectedQty || selectedQty < 1) return alert('Lütfen malzeme ve geçerli bir miktar girin.'); const product = productList.find(p => p.id === selectedProductId); const listContainer = document.getElementById('selected-products-list'); if (document.querySelector(`.selected-product-item[data-id="${product.id}"]`)) return alert('Bu ürün zaten listede.'); const unit = getUnitForProduct(product.name); const newItem = document.createElement('div'); newItem.className = 'selected-product-item'; newItem.dataset.id = product.id; newItem.dataset.qty = selectedQty; newItem.innerHTML = `<span>${product.code} ${product.name} - <b>${selectedQty} ${unit}</b></span><button class="delete-item-btn btn-sm btn-danger" title="Bu malzemeyi sil" onclick="this.parentElement.remove(); saveFormState();"><i class="fas fa-trash"></i></button>`; listContainer.appendChild(newItem); if (!productId) { select.value = ''; qtyInput.value = '1'; } saveFormState(); }
    function toggleCompleted(button) { const input = button.parentElement.querySelector('input[type="text"]'); const isCompleted = input.classList.toggle('completed'); input.readOnly = isCompleted; button.innerHTML = isCompleted ? '<i class="fas fa-undo"></i> Geri Al' : '<i class="fas fa-check"></i> Tamamlandı'; button.classList.toggle('undo', isCompleted); button.classList.toggle('btn-success', !isCompleted); button.classList.toggle('btn-warning', isCompleted); saveFormState(); }
    function toggleQuestionCompleted(button, id) { const itemDiv = document.getElementById(`fide-item-${id}`); const titleContainer = itemDiv.querySelector('.fide-title-container'); const isCompleted = titleContainer.classList.toggle('question-completed'); button.innerHTML = isCompleted ? '<i class="fas fa-undo"></i> Geri Al' : '<i class="fas fa-check"></i> Tamamlandı'; button.classList.toggle('undo', isCompleted); button.classList.toggle('btn-success', !isCompleted); button.classList.toggle('btn-warning', isCompleted); const inputArea = itemDiv.querySelector('.input-area'); if (inputArea) inputArea.style.display = isCompleted ? 'none' : 'block'; saveFormState(); }
    function toggleQuestionRemoved(button, id) { const itemDiv = document.getElementById(`fide-item-${id}`); const isRemoved = itemDiv.classList.toggle('question-removed'); const inputArea = itemDiv.querySelector('.input-area'); if(inputArea) inputArea.style.display = isRemoved ? 'none' : 'block'; button.innerHTML = isRemoved ? '<i class="fas fa-undo"></i> Geri Al' : '<i class="fas fa-times-circle"></i> Çıkar'; button.classList.toggle('btn-danger', !isRemoved); button.classList.toggle('btn-primary', isRemoved); const actions = button.closest('.fide-actions'); if(actions) { actions.querySelectorAll('button:not(.remove-btn)').forEach(b => b.disabled = isRemoved); } saveFormState(); }
    function addDynamicInput(id, value = '', isCompleted = false) { const container = document.getElementById(`sub-items-container-${id}`); if (!container) return; const newItem = document.createElement('div'); newItem.className = 'dynamic-input-item'; newItem.innerHTML = `<input type="text" placeholder="Eksikliği yazın..." value="${value}"><button class="status-btn btn-sm btn-success"><i class="fas fa-check"></i> Tamamlandı</button><button class="delete-bar btn-danger"><i class="fas fa-trash"></i></button>`; const input = newItem.querySelector('input'); const completeButton = newItem.querySelector('.status-btn'); input.addEventListener('keydown', e => { if (e.key === 'Enter') { e.preventDefault(); addDynamicInput(id); } }); input.addEventListener('blur', saveFormState); completeButton.onclick = () => toggleCompleted(completeButton); newItem.querySelector('.delete-bar').onclick = function() { initiateDeleteItem(this); }; if(isCompleted) toggleCompleted(completeButton); container.prepend(newItem); if (value === '') input.focus(); saveFormState(); }
    function handleFileSelect(event, type) { const file = event.target.files[0]; if (!file) return; const filename = file.name; const fileNameSpan = type === 'dide' ? document.getElementById('file-name') : document.getElementById('fide-file-name'); fileNameSpan.textContent = `Yüklü dosya: ${filename}`; const reader = new FileReader(); reader.readAsArrayBuffer(file); reader.onload = function(e) { try { const data = new Uint8Array(e.target.result); const workbook = XLSX.read(data, { type: 'array' }); const sheetName = workbook.SheetNames[0]; const worksheet = workbook.Sheets[sheetName]; const dataAsArray = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: "" }); if (type === 'dide') { processDideExcelData(dataAsArray, true, filename); } else { processFideExcelData(dataAsArray, true, filename); } } catch (error) { alert("Excel dosyası okunurken bir hata oluştu."); console.error("Excel okuma hatası:", error); } }; }
    function processDideExcelData(dataAsArray, saveToStorage, filename) { if (dataAsArray.length < 2) return alert('DiDe Excel dosyası beklenen formatta değil.'); let headerRowIndex = dataAsArray.findIndex(row => row.some(cell => typeof cell === 'string' && cell.trim() === 'Bayi Kodu')); if (headerRowIndex === -1) return alert('DiDe Excel dosyasında "Bayi Kodu" bulunamadı.'); const headerRow = dataAsArray[headerRowIndex].map(h => typeof h === 'string' ? h.trim() : h); const dataRows = dataAsArray.slice(headerRowIndex + 1); const bayiKoduIndex = headerRow.indexOf('Bayi Kodu'); const bayiIndex = headerRow.indexOf('Bayi'); const bayiYonetmeniIndex = headerRow.indexOf('Bayi Yönetmeni'); if ([bayiKoduIndex, bayiIndex, bayiYonetmeniIndex].includes(-1)) return alert('"Bayi Kodu", "Bayi" veya "Bayi Yönetmeni" sütunlarından biri bulunamadı.'); const processedData = dataRows.map(row => { if (!row[bayiKoduIndex]) return null; const scores = {}; headerRow.forEach((header, index) => { const monthNumber = parseInt(header); if (!isNaN(monthNumber) && monthNumber >= 1 && monthNumber <= 12) { if(row[index] !== null && row[index] !== undefined) scores[monthNumber] = row[index]; } }); return { 'Bayi Kodu': row[bayiKoduIndex], 'Bayi': row[bayiIndex], 'Bayi Yönetmeni': row[bayiYonetmeniIndex], 'scores': scores }; }).filter(d => d); if (saveToStorage) { const persistenceData = { timestamp: new Date().getTime(), data: processedData, filename: filename }; localStorage.setItem('didePersistenceData', JSON.stringify(persistenceData)); alert('DiDe puan dosyası başarıyla işlendi ve 30 günlüğüne hafızaya kaydedildi.'); } populateDideState(processedData); }
    function processFideExcelData(dataAsArray, saveToStorage, filename) { if (dataAsArray.length < 3) return alert('FiDe Excel dosyası beklenen formatta değil.'); const currentYear = new Date().getFullYear(); let yearRowIndex = -1; for(let i = 0; i < dataAsArray.length; i++) { if(dataAsArray[i].some(cell => String(cell).trim() == currentYear)) { yearRowIndex = i; break; } } if (yearRowIndex === -1) return alert(`FiDe Excel dosyasında '${currentYear}' yılını içeren satır bulunamadı.`); const yearRow = dataAsArray[yearRowIndex]; const filledYearRow = []; let lastKnownYear = null; for (const cell of yearRow) { if (cell !== null && cell !== undefined && String(cell).trim() !== "") { lastKnownYear = String(cell).trim(); } filledYearRow.push(lastKnownYear); } let monthRowIndex = yearRowIndex + 1; if (monthRowIndex >= dataAsArray.length) return alert('FiDe Excel dosyasında ay bilgileri bulunamadı.'); const monthRow = dataAsArray[monthRowIndex]; let headerRowIndex = dataAsArray.findIndex(row => row.some(cell => typeof cell === 'string' && cell.trim() === 'Bayi Kodu')); if (headerRowIndex === -1) return alert('FiDe Excel dosyasında "Bayi Kodu" bulunamadı.'); const headerRow = dataAsArray[headerRowIndex].map(h => typeof h === 'string' ? h.trim() : h); const dataRows = dataAsArray.slice(headerRowIndex + 1); const bayiKoduIndex = headerRow.indexOf('Bayi Kodu'); if (bayiKoduIndex === -1) return alert('FiDe Excel dosyasında "Bayi Kodu" sütunu bulunamadı.'); const processedData = dataRows.map(row => { if (!row[bayiKoduIndex]) return null; const scores = {}; for (let i = 0; i < filledYearRow.length; i++) { if (filledYearRow[i] == currentYear) { const monthNumber = parseInt(monthRow[i]); if (!isNaN(monthNumber) && monthNumber >= 1 && monthNumber <= 12) { if(row[i] !== null && row[i] !== undefined && row[i] !== "") scores[monthNumber] = row[i]; } } } return { 'Bayi Kodu': row[bayiKoduIndex], 'scores': scores }; }).filter(d => d); if (saveToStorage) { const persistenceData = { timestamp: new Date().getTime(), data: processedData, filename: filename }; localStorage.setItem('fidePersistenceData', JSON.stringify(persistenceData)); alert('FiDe puan dosyası başarıyla işlendi ve 30 günlüğüne hafızaya kaydedildi.'); } populateFideState(processedData); }
    function populateDideState(data) { dideData = data; const storeMap = new Map(); dideData.forEach(row => { if (row['Bayi Kodu'] && !storeMap.has(row['Bayi Kodu'])) { storeMap.set(row['Bayi Kodu'], { bayiKodu: row['Bayi Kodu'], bayiAdi: row['Bayi'] }); } }); uniqueStores = Array.from(storeMap.values()).sort((a, b) => a.bayiAdi.localeCompare(b.bayiAdi)); document.getElementById('store-list').innerHTML = ''; document.getElementById('store-selection-area').style.display = 'block'; document.getElementById('clear-storage-btn').style.display = 'inline-flex'; document.getElementById('clear-excel-btn').style.display = 'inline-flex'; }
    function populateFideState(data) { fideData = data; document.getElementById('clear-fide-excel-btn').style.display = 'inline-flex'; }
    function loadDideDataFromStorage() { const storedDataJSON = localStorage.getItem('didePersistenceData'); if (!storedDataJSON) return; try { const storedData = JSON.parse(storedDataJSON); if ((new Date().getTime() - storedData.timestamp) / (1000 * 60 * 60 * 24) > 30) { localStorage.removeItem('didePersistenceData'); expiredExcelFiles.push('DiDe Puan Excel'); return; } if (storedData.filename) { document.getElementById('file-name').textContent = `Yüklü dosya: ${storedData.filename}`; } populateDideState(storedData.data); } catch (e) { localStorage.removeItem('didePersistenceData'); } }
    function loadFideDataFromStorage() { const storedDataJSON = localStorage.getItem('fidePersistenceData'); if (!storedDataJSON) return; try { const storedData = JSON.parse(storedDataJSON); if ((new Date().getTime() - storedData.timestamp) / (1000 * 60 * 60 * 24) > 30) { localStorage.removeItem('fidePersistenceData'); expiredExcelFiles.push('FiDe Puan Excel'); return; } if (storedData.filename) { document.getElementById('fide-file-name').textContent = `Yüklü dosya: ${storedData.filename}`; } populateFideState(storedData.data); } catch(e) { localStorage.removeItem('fidePersistenceData'); } }
    function displayStores(stores) { const storeListDiv = document.getElementById('store-list'); storeListDiv.innerHTML = ''; stores.forEach(store => { const item = document.createElement('div'); item.className = 'store-item'; item.textContent = `${store.bayiAdi} (${store.bayiKodu})`; item.dataset.bayiKodu = store.bayiKodu; item.dataset.bayiAdi = store.bayiAdi; item.addEventListener('click', () => { document.querySelectorAll('.store-item').forEach(i => i.classList.remove('selected')); item.classList.add('selected'); selectedStore = { bayiKodu: store.bayiKodu, bayiAdi: store.bayiAdi }; localStorage.setItem('lastSelectedStoreCode', store.bayiKodu); const searchInput = document.getElementById('store-search-input'); searchInput.value = `${store.bayiKodu} - ${store.bayiAdi}`; storeListDiv.innerHTML = ''; storeListDiv.style.display = 'none'; isStoreSelected = true; loadReportForStore(store.bayiKodu); }); storeListDiv.appendChild(item); }); }
    function generateEmail() { if (!selectedStore) return alert('Lütfen denetime başlamadan önce bir bayi seçin!'); saveFormState(); const storeInfo = dideData.find(row => String(row['Bayi Kodu']) === String(selectedStore.bayiKodu)); const fideStoreInfo = fideData.find(row => String(row['Bayi Kodu']) === String(selectedStore.bayiKodu)); if (!storeInfo) return alert("Seçilen bayi için DiDe verisi bulunamadı."); const reportData = getFormDataForSaving(); document.getElementById('save-code-area').value = JSON.stringify(reportData, null, 2); document.getElementById('save-section').style.display = 'block'; /* ... rest of the function */ }
    function downloadReportCode() { const reportCode = document.getElementById('save-code-area').value; if (!selectedStore || !reportCode) return alert('İndirilecek rapor kodu bulunamadı.'); const filename = `${selectedStore.bayiKodu} - ${selectedStore.bayiAdi.substring(0, 15).trim()}.txt`; const blob = new Blob([reportCode], { type: 'text/plain;charset=utf-8' }); const link = document.createElement('a'); const url = URL.createObjectURL(blob); link.href = url; link.download = filename; document.body.appendChild(link); link.click(); document.body.removeChild(link); }
    function loadReportForStore(bayiKodu) { const allReports = JSON.parse(localStorage.getItem('allFideReports')) || {}; const storeKey = `store_${bayiKodu}`; if (allReports[storeKey]) loadReport(allReports[storeKey].data); else resetForm(); }
    function loadReport(reportDataFromCode) { try { let reportData = reportDataFromCode; if (!reportData) { const loadCode = document.getElementById('load-code-area').value.trim(); if (!loadCode) return alert('Lütfen yüklenecek kodu yapıştırın.'); reportData = JSON.parse(loadCode); } isStoreSelected = true; resetForm(); if (reportData.selectedStore) { selectedStore = reportData.selectedStore; const searchInput = document.getElementById('store-search-input'); searchInput.value = `${selectedStore.bayiKodu} - ${selectedStore.bayiAdi}`; document.getElementById('store-list').style.display = 'none'; } for (const qId in reportData.questions_status) { const data = reportData.questions_status[qId]; const questionItem = document.getElementById(`fide-item-${qId}`); if (!questionItem) continue; const completeButton = questionItem.querySelector('.fide-actions .status-btn'); const removeButton = questionItem.querySelector('.fide-actions .remove-btn'); if (data.removed && removeButton) toggleQuestionRemoved(removeButton, qId); else if (data.completed && completeButton) toggleQuestionCompleted(completeButton, qId); if (data.dynamicInputs) data.dynamicInputs.forEach(input => addDynamicInput(qId === '15' ? 'fide15_pleksi' : `fide${qId}`, input.text, input.completed)); if (data.selectedProducts) data.selectedProducts.forEach(prod => addProductToList(prod.id, prod.qty)); } if (!reportDataFromCode) { alert('Rapor başarıyla yüklendi!'); document.getElementById('load-code-area').value = ''; } } catch (error) { alert('Geçersiz rapor kodu!'); } }
    function startNewReport() { selectedStore = null; isStoreSelected = false; document.getElementById('store-search-input').value = ''; localStorage.removeItem('lastSelectedStoreCode'); resetForm(); }
    function backupAllReports() { const allReports = localStorage.getItem('allFideReports'); if (!allReports || Object.keys(JSON.parse(allReports)).length === 0) return alert('Yedeklenecek kayıtlı rapor bulunamadı.'); const blob = new Blob([allReports], { type: 'application/json;charset=utf-8' }); const today = new Date().toISOString().slice(0, 10); const filename = `fide_rapor_yedek_${today}.json`; const link = document.createElement('a'); const url = URL.createObjectURL(blob); link.setAttribute('href', url); link.setAttribute('download', filename); link.style.visibility = 'hidden'; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); }
    function handleRestoreUpload(event) { const file = event.target.files[0]; if (!file) return; if (confirm("Bu işlem mevcut tüm raporların üzerine yazılacaktır. Devam etmek istediğinizden emin misiniz?")) { const reader = new FileReader(); reader.onload = function(e) { try { const restoredData = e.target.result; JSON.parse(restoredData); localStorage.setItem('allFideReports', restoredData); if(currentUser && isCloudSyncEnabled) { saveDataToFirebase(); } alert('Yedek başarıyla geri yüklendi! Sayfa yenileniyor.'); window.location.reload(); } catch (error) { alert('Geçersiz veya bozuk yedek dosyası!'); } }; reader.readAsText(file); } event.target.value = null; }
    async function handleMergeUpload(event) { const files = event.target.files; if (!files || files.length < 2) return alert("Lütfen birleştirmek için en az 2 yedek dosyası seçin."); let mergedReports = {}; let fileReadPromises = []; for (const file of files) { const promise = new Promise((resolve, reject) => { const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); resolve(data); } catch (err) { reject(`'${file.name}' dosyası okunamadı.`); } }; reader.onerror = () => reject(`'${file.name}' dosyası okunurken hata.`); reader.readAsText(file); }); fileReadPromises.push(promise); } try { const allBackupData = await Promise.all(fileReadPromises); allBackupData.forEach(backupData => { for (const storeKey in backupData) { if (Object.hasOwnProperty.call(backupData, storeKey)) { const newReport = backupData[storeKey]; if (!mergedReports[storeKey] || newReport.timestamp > mergedReports[storeKey].timestamp) { mergedReports[storeKey] = newReport; } } } }); const mergedDataStr = JSON.stringify(mergedReports, null, 2); const blob = new Blob([mergedDataStr], { type: 'application/json;charset=utf-8' }); const today = new Date().toISOString().slice(0, 10); const filename = `birlesik_fide_rapor_yedek_${today}.json`; const link = document.createElement('a'); const url = URL.createObjectURL(blob); link.setAttribute('href', url); link.setAttribute('download', filename); document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); alert(`Başarılı! Birleştirilmiş yedek dosyanız '${filename}' adıyla indirildi.`); } catch (error) { alert("Birleştirme hatası:\n" + error); } finally { event.target.value = null; } }
    function restoreLastSession() { const lastStoreCode = localStorage.getItem('lastSelectedStoreCode'); if (lastStoreCode && uniqueStores.length > 0) { const storeToRestore = uniqueStores.find(s => String(s.bayiKodu) === String(lastStoreCode)); if (storeToRestore) { selectedStore = storeToRestore; isStoreSelected = true; const searchInput = document.getElementById('store-search-input'); searchInput.value = `${storeToRestore.bayiKodu} - ${storeToRestore.bayiAdi}`; document.getElementById('store-list').style.display = 'none'; loadReportForStore(storeToRestore.bayiKodu); } } }
    function renderQuestionManager() { const managerList = document.getElementById('manager-list'); managerList.innerHTML = ''; fideQuestions.forEach(q => { const itemDiv = document.createElement('div'); itemDiv.className = 'manager-item'; itemDiv.dataset.id = q.id; let staticItemsText = (q.staticItems || []).join('\n'); const typeOptions = ['standard', 'product_list']; const selectOptionsHTML = typeOptions.map(type => `<option value="${type}" ${q.type === type ? 'selected' : ''}>${type}</option>`).join(''); itemDiv.innerHTML = `<div class="manager-item-grid"><div><label>Soru ID</label><input type="number" value="${q.id}" readonly></div><div><label>Soru Başlığı</label><input type="text" value="${q.title}"></div><div><label>Soru Tipi</label><select>${selectOptionsHTML}</select></div></div><div><label>Statik Maddeler (Her satıra bir madde)</label><textarea rows="3">${staticItemsText}</textarea></div><div class="manager-item-footer"><button class="btn-danger btn-sm" onclick="deleteQuestionUI(${q.id})"><i class="fas fa-trash"></i> Soruyu Sil</button></div>`; managerList.appendChild(itemDiv); });}
    function addNewQuestionUI() { const managerList = document.getElementById('manager-list'); const existingIds = fideQuestions.map(q => q.id); const newId = existingIds.length > 0 ? Math.max(...existingIds) + 1 : 1; const itemDiv = document.createElement('div'); itemDiv.className = 'manager-item'; itemDiv.style.backgroundColor = '#dcfce7'; itemDiv.dataset.id = newId; itemDiv.innerHTML = `<div class="manager-item-grid"><div><label>Soru ID</label><input type="number" value="${newId}"></div><div><label>Soru Başlığı</label><input type="text" placeholder="Yeni sorunun başlığını yazın..."></div><div><label>Soru Tipi</label><select><option value="standard" selected>standard</option><option value="product_list">product_list</option></select></div></div><div><label>Statik Maddeler (Her satıra bir madde)</label><textarea rows="3"></textarea></div><div class="manager-item-footer"><button class="btn-danger btn-sm" onclick="this.parentElement.parentElement.remove()"><i class="fas fa-times"></i> İptal Et</button></div>`; managerList.appendChild(itemDiv); itemDiv.querySelector('input[type="text"]').focus(); }
    function deleteQuestionUI(id) { if (confirm(`FiDe ${id} sorusunu silmek istediğinizden emin misiniz?`)) { const itemToDelete = document.querySelector(`.manager-item[data-id="${id}"]`); if(itemToDelete) { itemToDelete.style.display = 'none'; itemToDelete.classList.add('to-be-deleted'); } } }
    function saveQuestions() { const managerList = document.getElementById('manager-list'); const newQuestions = []; const ids = new Set(); const items = managerList.querySelectorAll('.manager-item'); for (const item of items) { if (item.classList.contains('to-be-deleted')) continue; const id = parseInt(item.querySelectorAll('input')[0].value); const title = item.querySelectorAll('input')[1].value.trim(); const type = item.querySelector('select').value; const staticItemsText = item.querySelector('textarea').value; if (!id || !title) { alert(`ID veya Başlık boş olamaz.`); return; } if(ids.has(id)) { alert(`HATA: ${id} ID'si mükerrer.`); return; } ids.add(id); const staticItems = staticItemsText.split('\n').map(s => s.trim()).filter(s => s); const newQuestion = { id, title, type }; if (staticItems.length > 0) newQuestion.staticItems = staticItems; newQuestions.push(newQuestion); } newQuestions.sort((a, b) => a.id - b.id); const finalJsonData = { questions: newQuestions, productList: productList }; const dataStr = JSON.stringify(finalJsonData, null, 2); const blob = new Blob([dataStr], { type: 'application/json' }); const url = URL.createObjectURL(blob); const link = document.createElement('a'); link.download = 'fide_soru_listesi.json'; link.href = url; link.click(); URL.revokeObjectURL(url); alert("Güncellenmiş sorularınız 'fide_soru_listesi.json' olarak indirildi."); }

    async function initializeApp() {
        let isUiInitialized = false;
        const initializeUiOnce = () => {
            if (isUiInitialized) return;
            loadDideDataFromStorage();
            loadFideDataFromStorage();
            buildForm();
            restoreLastSession();
            setupEventListeners();
            isUiInitialized = true;
        };

        try {
            const response = await fetch('https://mkotbas.github.io/host/fide_soru_listesi.json');
            if (response.ok) {
                const jsonData = await response.json();
                fideQuestions = jsonData.questions || [];
                productList = jsonData.productList || [];
            } else { throw new Error('Soru dosyası alınamadı'); }
        } catch (error) {
            console.error("Soru dosyası yüklenemedi:", error);
            fideQuestions = fallbackFideQuestions;
            document.getElementById('initialization-error').style.display = 'block';
        }

        try {
            await auth.signInAnonymously();
            currentUser = auth.currentUser;
            if (!currentUser) throw new Error("Anonim kullanıcı oturumu başlatılamadı.");
            
            db.ref(`users/${currentUser.uid}/allFideReports`).on('value', (snapshot) => {
                updateCloudStatusText(true);
                if (snapshot.exists()) {
                    const cloudReports = snapshot.val();
                    localStorage.setItem('allFideReports', JSON.stringify(cloudReports));
                }
                initializeUiOnce();
            }, (errorObject) => {
                console.error("Firebase okuma hatası:", errorObject);
                throw errorObject;
            });
        } catch (error) {
            console.error("Firebase Hatası:", error);
            updateCloudStatusText(false);
            document.getElementById('cloud-toggle').checked = false;
            isCloudSyncEnabled = false;
            alert("Güvenli bulut bağlantısı kurulamadı. Sistem internetsiz modda devam edecektir.");
            initializeUiOnce();
        }
    }
    
    function setupEventListeners() {
        document.getElementById('excel-file-input').addEventListener('change', (e) => handleFileSelect(e, 'dide'));
        document.getElementById('fide-excel-file-input').addEventListener('change', (e) => handleFileSelect(e, 'fide'));
        document.getElementById('backup-btn').addEventListener('click', backupAllReports);
        document.getElementById('restore-file-input').addEventListener('change', handleRestoreUpload);
        document.getElementById('merge-file-input').addEventListener('change', handleMergeUpload);
        document.getElementById('new-report-btn').addEventListener('click', startNewReport);
        document.getElementById('clear-storage-btn').addEventListener('click', () => { const dogruSifreHash = 'ZmRlMDAx'; const girilenSifre = prompt("Bu işlem geri alınamaz. Hem lokaldeki hem de (bağlantı varsa) buluttaki tüm raporları kalıcı olarak silmek için şifreyi girin:"); if (girilenSifre) { const girilenSifreHash = btoa(girilenSifre); if (girilenSifreHash === dogruSifreHash) { if (confirm("Şifre doğru. Emin misiniz? Kaydedilmiş TÜM bayi raporları kalıcı olarak silinecektir.")) { localStorage.removeItem('allFideReports'); localStorage.removeItem('lastSelectedStoreCode'); if(currentUser && isCloudSyncEnabled){ db.ref(`users/${currentUser.uid}/allFideReports`).remove(); } alert("Tüm raporlar temizlendi. Sayfa yenileniyor."); window.location.reload(); } } else { alert("Hatalı şifre! Silme işlemi iptal edildi."); } } });
        document.getElementById('clear-excel-btn').addEventListener('click', () => { if (confirm("Yüklenmiş olan DiDe Excel verisini hafızadan silmek istediğinizden emin misiniz?")) { localStorage.removeItem('didePersistenceData'); alert("DiDe Excel verisi temizlendi. Sayfa yenileniyor."); window.location.reload(); } });
        document.getElementById('clear-fide-excel-btn').addEventListener('click', () => { if (confirm("Yüklenmiş olan FiDe Excel verisini hafızadan silmek istediğinizden emin misiniz?")) { localStorage.removeItem('fidePersistenceData'); alert("FiDe Excel verisi temizlendi. Sayfa yenileniyor."); window.location.reload(); } });
        document.getElementById('store-search-input').addEventListener('keyup', (e) => { selectedStore = null; isStoreSelected = false; buildForm(); const filter = e.target.value.toLowerCase().trim(); const storeListDiv = document.getElementById('store-list'); storeListDiv.style.display = 'block'; if (filter === "") { storeListDiv.innerHTML = ''; return; } const filteredStores = uniqueStores.filter(store => (store.bayiAdi && store.bayiAdi.toLowerCase().includes(filter)) || (store.bayiKodu && String(store.bayiKodu).toLowerCase().includes(filter)) ); displayStores(filteredStores); });
        document.getElementById('toggle-manager-btn').addEventListener('click', () => { const manager = document.getElementById('question-manager'); const mainCards = [document.getElementById('dide-upload-card'), document.getElementById('load-section'), document.getElementById('form-content'), document.querySelector('.action-button')]; const isHidden = manager.style.display === 'none' || manager.style.display === ''; if(isHidden) { const pass = prompt("Şifre:"); if(btoa(pass) === 'ZmRlMDAx'){ renderQuestionManager(); manager.style.display = 'block'; mainCards.forEach(c => c.style.display = 'none'); } else { alert("Hatalı şifre"); } } else { manager.style.display = 'none'; mainCards.forEach(c => c.style.display = ''); } });
        document.getElementById('cloud-toggle').addEventListener('change', (e) => { isCloudSyncEnabled = e.target.checked; updateCloudStatusText(isCloudSyncEnabled); if(isCloudSyncEnabled) { saveDataToFirebase(); } });
    }
    
    window.onload = initializeApp;
    </script>
</body>
</html>