<div class="ky card">
    <!-- LIST VIEW -->
    <div id="user-list-view" class="ky-view ky-list-view">
        <div class="ky-header">
            <div class="ky-header-left">
                <h3 class="module-title ky-title">Sistem Kullanıcıları</h3>
                <p class="module-description ky-subtitle">
                    Sisteme kayıtlı tüm kullanıcıları burada yönetebilirsiniz. Bir kullanıcıyı düzenlemek veya silmek için ilgili satırdaki butonları kullanın.
                </p>
            </div>

            <div class="ky-header-right">
                <button id="add-new-user-btn" class="btn-success btn-sm ky-primary-action">
                    <i class="fas fa-plus"></i> Yeni Kullanıcı Ekle
                </button>
            </div>
        </div>

        <div class="ky-surface">
            <div class="table-responsive ky-table-wrap">
                <table id="users-table" class="ky-table">
                    <thead>
                        <tr>
                            <th>İsim</th>
                            <th>E-posta</th>
                            <th>Rol</th>
                            <th>Durum (Ban)</th>
                            <th>Mobil Erişim</th>
                            <th>Oluşturulma Tarihi</th>
                            <th>İşlemler</th>
                        </tr>
                    </thead>
                    <tbody id="users-table-body">
                        <!-- JS dolduruyor -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- FORM VIEW -->
    <div id="user-form-view" class="ky-view ky-form-view" style="display: none;">
        <div class="ky-form-topbar">
            <div class="ky-form-topbar-left">
                <h3 id="user-form-title" class="ky-form-title">Yeni Kullanıcı Ekle</h3>
                <div class="ky-form-meta">
                    <span class="ky-pill"><i class="fas fa-user"></i> Kullanıcı Bilgileri</span>
                    <span class="ky-pill ky-pill-muted"><i class="fas fa-shield-alt"></i> Güvenlik</span>
                    <span class="ky-pill ky-pill-muted"><i class="fas fa-desktop"></i> Cihazlar</span>
                </div>
            </div>

            <div class="ky-form-topbar-right">
                <button type="button" id="cancel-user-form-btn" class="btn-secondary ky-topbar-btn">
                    <i class="fas fa-arrow-left"></i> Listeye Dön
                </button>
            </div>
        </div>

        <form id="user-form" class="ky-form">
            <input type="hidden" id="user-id-input">

            <!-- SECTION: BASIC INFO -->
            <section class="ky-section">
                <div class="ky-section-header">
                    <h4 class="ky-section-title"><i class="fas fa-id-card"></i> Temel Bilgiler</h4>
                    <p class="ky-section-desc">Kullanıcının ad, e-posta ve rol bilgilerini düzenleyin.</p>
                </div>

                <div class="ky-grid">
                    <div class="form-group ky-field">
                        <label for="user-name-input">İsim Soyisim</label>
                        <input type="text" id="user-name-input" required>
                    </div>

                    <div class="form-group ky-field">
                        <label for="user-email-input">E-posta Adresi</label>
                        <input type="email" id="user-email-input" required>
                        <small>E-posta alanı düzenleme modunda kilitlidir (güvenlik gereği).</small>
                    </div>

                    <div class="form-group ky-field">
                        <label for="user-role-select">Kullanıcı Rolü</label>
                        <select id="user-role-select" required>
                            <option value="client">Standart Kullanıcı (Client)</option>
                            <option value="admin">Yönetici (Admin)</option>
                        </select>
                        <small>Admin kullanıcılar için cihaz limiti/kilidi uygulanmaz.</small>
                    </div>
                </div>

                <div id="password-fields-wrapper" class="ky-password-wrap">
                    <div class="ky-divider"></div>

                    <div class="ky-section-header ky-section-header-compact">
                        <h4 class="ky-section-title"><i class="fas fa-key"></i> Parola</h4>
                        <p class="ky-section-desc">Yeni kullanıcı oluştururken parola zorunludur. Düzenlemede parola alanları gizlidir.</p>
                    </div>

                    <div class="ky-grid">
                        <div class="form-group ky-field">
                            <label for="user-password-input">Parola</label>
                            <input type="password" id="user-password-input" placeholder="Yeni parola belirleyin">
                        </div>
                        <div class="form-group ky-field">
                            <label for="user-password-confirm-input">Parola (Tekrar)</label>
                            <input type="password" id="user-password-confirm-input" placeholder="Yeni parolayı doğrulayın">
                        </div>
                    </div>
                </div>
            </section>

            <!-- SECTION: SECURITY -->
            <section class="ky-section">
                <div class="ky-section-header">
                    <h4 class="ky-section-title"><i class="fas fa-shield-alt"></i> Güvenlik Ayarları</h4>
                    <p class="ky-section-desc">Mobil erişim ve (client için) bireysel cihaz limiti ayarları.</p>
                </div>

                <div class="form-row ky-row">
                    <div class="form-group form-group-checkbox-modern ky-card-field" id="mobile-access-box">
                        <label>Mobil Erişim İzni</label>
                        <div class="checkbox-wrapper">
                            <input type="checkbox" id="user-mobile-access-checkbox">
                            <label for="user-mobile-access-checkbox" class="checkbox-label">
                                Mobil Cihazlardan Erişime İzin Ver
                            </label>
                        </div>
                        <small>Bu izin kapalıysa kullanıcı mobil cihazlardan giriş yapamaz.</small>
                    </div>

                    <div class="form-group ky-card-field" id="user-device-limit-section" style="display: none;">
                        <label for="user-device-limit-input">Bireysel Cihaz Limiti (Max: 5)</label>
                        <input type="number" id="user-device-limit-input" min="1" max="5" value="1">
                        <small>Bu standart kullanıcının kaç farklı cihazdan giriş yapabileceğini belirler.</small>
                    </div>
                </div>

                <div class="form-group ky-danger-zone" id="user-ban-section" style="display: none;">
                    <label>Hesap Durumu (Anlık Kilitleme)</label>
                    <button type="button" id="toggle-ban-user-btn" class="btn-danger ky-danger-btn" style="width: 100%;">
                        <i class="fas fa-ban"></i> Bu Kullanıcının Hesabını Kilitle (BAN)
                    </button>
                    <small>Bu işlem anlıktır. Kullanıcı o anda ne yaparsa yapsın sistemden atılır ve "Hesap kilitlendi" mesajı alır.</small>
                </div>
            </section>

            <!-- SECTION: DEVICES -->
            <section class="ky-section">
                <div class="ky-section-header">
                    <h4 id="devices-title" class="ky-section-title" style="display: none;">
                        <i class="fas fa-desktop"></i> Kayıtlı Cihazlar
                    </h4>
                    <p id="devices-description" class="ky-section-desc" style="display: none;">
                        Kullanıcının giriş yaptığı ve kayıtlı olan cihazları. Buradan tek tek cihazları silebilir (sıfırlayabilir) veya kilitleyebilirsiniz.
                    </p>
                </div>

                <hr id="devices-hr" class="ky-divider" style="display: none;">

                <div id="devices-list-loading" class="ky-loading" style="display: none;">
                    <i class="fas fa-spinner fa-spin"></i> Cihazlar yükleniyor...
                </div>

                <div class="table-responsive ky-table-wrap" id="user-devices-table-wrapper" style="display: none;">
                    <table id="user-devices-table" class="ky-table">
                        <thead>
                            <tr>
                                <th>Cihaz Bilgisi</th>
                                <th>Son Giriş</th>
                                <th>Durum</th>
                                <th>İşlemler</th>
                            </tr>
                        </thead>
                        <tbody id="user-devices-table-body">
                            <!-- JS dolduruyor -->
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- ACTIONS -->
            <div class="form-actions ky-actions">
                <button type="submit" id="save-user-btn" class="btn-primary ky-save">
                    <i class="fas fa-save"></i> Kaydet
                </button>
                <button type="button" id="cancel-user-form-btn" class="btn-secondary ky-cancel">
                    İptal
                </button>
            </div>
        </form>
    </div>
</div>
