import{P as b}from"./db-config-DOJnS-mV.js";const f=[{id:"denetim-takip",name:"Denetim Takip",icon:"fas fa-calendar-check",path:"../modules/denetim-takip/"},{id:"fide-main-parent",name:"FiDe Ana Sayfası",icon:"fas fa-home",submenu:[{id:"eposta-taslagi",name:"E-posta Taslağı",icon:"fas fa-envelope-open-text",path:"../modules/eposta-taslagi/"}]},{id:"bayi-yoneticisi",name:"Bayi Yöneticisi",icon:"fas fa-store",path:"../modules/bayi-yoneticisi/"},{id:"soru-yoneticisi",name:"Soru Yöneticisi",icon:"fas fa-edit",path:"../modules/soru-yoneticisi/"},{id:"veritabani-yonetim",name:"Veritabanı Yönetimi",icon:"fas fa-cogs",path:"../modules/veritabani-yonetim/"},{id:"kullanici-yoneticisi",name:"Kullanıcı Yönetimi",icon:"fas fa-users-cog",path:"../modules/kullanici-yoneticisi/"}];let r=null,s;E();async function E(){try{s=new PocketBase(b)}catch(i){console.error("PocketBase başlatılamadı. Adresin doğru olduğundan emin olun.",i)}const t=s&&s.authStore.isValid,e=t?s.authStore.model.role:null;if(k(t),B(t),e==="admin")g("admin"),r||u("denetim-takip"),h();else if(e==="client")g("client"),u("denetim-takip"),h();else{document.getElementById("module-menu").innerHTML="";const i=document.getElementById("module-container");i.innerHTML=`
            <div style="text-align: center; padding: 50px; color: #dc3545;">
                <i class="fas fa-exclamation-triangle fa-3x"></i>
                <h2>Erişim Reddedildi</h2>
                <p>Bu alana erişim yetkiniz bulunmamaktadır.</p>
            </div>
        `,document.getElementById("module-title").innerHTML='<i class="fas fa-ban"></i> Yetkisiz Erişim'}L()}function g(t){const e=document.getElementById("module-menu");e.innerHTML="";let i=[];t==="admin"?i=f:t==="client"&&(i=f.filter(o=>o.id==="denetim-takip")),i.forEach(o=>{const a=document.createElement("li");if(o.submenu){a.classList.add("has-submenu"),a.innerHTML=`<a href="#"><i class="${o.icon}"></i><span>${o.name}</span></a>`;const n=document.createElement("ul");n.className="submenu",o.submenu.forEach(l=>{const c=document.createElement("li");c.innerHTML=`<a href="#" data-module-id="${l.id}"><i class="${l.icon}"></i><span>${l.name}</span></a>`,c.querySelector("a").addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),r!==l.id&&u(l.id)}),n.appendChild(c)}),a.appendChild(n),a.querySelector("a").addEventListener("click",l=>{l.preventDefault(),a.classList.toggle("open"),n.classList.toggle("open")})}else a.innerHTML=`<a href="#" data-module-id="${o.id}"><i class="${o.icon}"></i><span>${o.name}</span></a>`,a.querySelector("a").addEventListener("click",n=>{n.preventDefault(),r!==o.id&&u(o.id)});e.appendChild(a)})}async function u(t){let e;for(const n of f){if(n.id===t){e=n;break}if(n.submenu){const l=n.submenu.find(c=>c.id===t);if(l){e=l;break}}}if(!e){console.error("Modül bulunamadı:",t);return}r=t,document.querySelectorAll(".sidebar-menu a").forEach(n=>n.classList.remove("active"));const i=document.querySelector(`.sidebar-menu a[data-module-id="${t}"]`);if(i){i.classList.add("active");const n=i.closest(".has-submenu");n&&!n.classList.contains("open")&&(n.classList.add("open"),n.querySelector(".submenu").classList.add("open"))}const o=document.getElementById("module-container"),a=document.getElementById("module-title");o.innerHTML=`<p>Modül yükleniyor: ${e.name}...</p>`,a.innerHTML=`<i class="${e.icon}"></i> ${e.name}`;try{const n=await fetch(`${e.path}${e.id}.html`);if(!n.ok)throw new Error(`Dosya bulunamadı: ${e.id}.html`);o.innerHTML=await n.text();const l=`module-css-${e.id}`;if(!document.getElementById(l)){const d=document.createElement("link");d.id=l,d.rel="stylesheet",d.href=`${e.path}${e.id}.css`,document.head.appendChild(d)}const c=document.getElementById("module-script");c&&c.remove();const p=`initialize${e.id.split("-").map(d=>d.charAt(0).toUpperCase()+d.slice(1)).join("")}Module`,y=await import(`${e.path}${e.id}.js?v=${new Date().getTime()}`);typeof y[p]=="function"?y[p](s):console.error(`Modern modül (import) başlatma fonksiyonu bulunamadı: ${p}. Modülün .js dosyasının bu fonksiyonu 'export' ettiğinden emin olun.`)}catch(n){console.error("Modül yüklenirken hata oluştu:",n),o.innerHTML=`<p style="color: red;">'${e.name}' modülü yüklenemedi. <br>Hata: ${n.message}. <br>Lütfen '../modules/${e.id}/' klasörünün ve ilgili dosyaların sunucuda olduğundan emin olun.</p>`}}function h(){if(!s||!s.authStore.isValid)return;const t=s.authStore.model.id;try{s.collection("users").subscribe(t,function(e){e.record&&e.record.is_banned===!0&&(console.warn("Admin kilitlendi (is_banned=true). Oturum sonlandırılıyor."),alert("Hesabınız başka bir yönetici tarafından kilitlenmiştir. Sistemden çıkış yapılıyor."),s.authStore.clear(),window.location.reload())})}catch(e){console.error("Admin dinlemesi (subscribe) başlatılamadı:",e)}}function k(t){const e=document.getElementById("login-toggle-btn"),i=document.getElementById("logout-btn"),o=document.getElementById("login-popup");t?(e.style.display="none",i.style.display="inline-flex",o&&(o.style.display="none")):(e.style.display="inline-flex",i.style.display="none")}function B(t){const e=document.getElementById("connection-status-switch"),i=document.getElementById("connection-status-text");e.classList.toggle("connected",t),e.classList.toggle("disconnected",!t),i.textContent=t?"Buluta Bağlı":"Bağlı Değil"}function L(){const t=document.getElementById("login-toggle-btn"),e=document.getElementById("logout-btn"),i=document.getElementById("login-popup"),o=document.getElementById("login-submit-btn");t.addEventListener("click",a=>{a.stopPropagation(),i.style.display=i.style.display==="block"?"none":"block"}),e.addEventListener("click",()=>{s.authStore.clear(),window.location.reload()}),o.addEventListener("click",async()=>{const a=document.getElementById("email-input").value,n=document.getElementById("password-input").value,l=document.getElementById("login-error");if(l.textContent="",!a||!n){l.textContent="Lütfen tüm alanları doldurun.";return}try{await s.collection("users").authWithPassword(a,n),window.location.reload()}catch{l.textContent="E-posta veya şifre hatalı."}}),window.addEventListener("click",function(a){const n=document.getElementById("auth-controls");n&&!n.contains(a.target)&&i&&(i.style.display="none")})}
