<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proje Dökümantasyonu: Arçelik Denetim Formu</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --light-bg: #ffffff;
            --light-border: #e5e7eb;
            --light-text-primary: #1f2937;
            --light-text-secondary: #6b7280;
            --light-container-bg: #f9fafb;
            --primary-color: #3b82f6;
            --danger-color: #ef4444;
            --warning-color: #f59e0b;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-container-bg);
            color: var(--light-text-primary);
            line-height: 1.7;
            padding: 20px;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            background-color: var(--light-bg);
            border: 1px solid var(--light-border);
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        }

        header {
            padding: 30px 40px;
            background-color: var(--primary-color);
            color: white;
            border-radius: 12px 12px 0 0;
        }

        header h1 {
            margin: 0;
            font-size: 2.5em;
        }

        header p {
            margin: 5px 0 0 0;
            font-size: 1.2em;
            opacity: 0.9;
        }

        section {
            padding: 30px 40px;
            border-bottom: 1px solid var(--light-border);
        }

        section:last-child {
            border-bottom: none;
        }

        h2, h3, h4 {
            color: var(--light-text-primary);
            margin-top: 0;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--primary-color);
            display: inline-block;
        }
        
        h2 i, h3 i, h4 i {
            color: var(--primary-color);
            margin-right: 10px;
        }

        code {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            background-color: #f3f4f6;
            color: #4b5563;
            padding: 3px 6px;
            border-radius: 6px;
            font-size: 0.9em;
        }

        pre {
            background-color: var(--light-container-bg);
            border: 1px solid var(--light-border);
            border-radius: 8px;
            padding: 20px;
            overflow-x: auto;
            font-size: 0.9em;
            line-height: 1.6;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
            border: 1px solid var(--light-border);
        }

        th, td {
            border: 1px solid var(--light-border);
            padding: 12px 15px;
            text-align: left;
            vertical-align: top;
        }

        th {
            background-color: var(--light-container-bg);
            font-weight: 600;
        }

        tr:nth-child(even) {
            background-color: #fcfcfc;
        }
        
        td:first-child code,
        td:first-child strong {
            font-weight: 600;
            color: #3730a3;
        }
        
        ul {
            padding-left: 20px;
        }
        
        li {
            margin-bottom: 10px;
        }
        
        .update-guide .info-box {
            background: #fffbeb;
            border: 1px solid #fde68a;
            border-left: 5px solid var(--warning-color);
            padding: 15px 20px;
            border-radius: 6px;
            margin-bottom: 15px;
        }
        .update-guide .info-box strong {
            color: #92400e;
        }
        
        #ai-instructions {
            background-color: #fef2f2; /* Açık Kırmızı */
            border: 1px solid #fecaca;
            border-left: 5px solid var(--danger-color, #ef4444);
            border-radius: 8px;
            margin: 30px 40px 0 40px; /* main padding'ine uyumlu */
            padding: 25px;
        }
        #ai-instructions h2 {
            border-bottom-color: var(--danger-color);
            margin-top: 0;
            color: #991b1b;
        }
        #ai-instructions h2 i {
            color: var(--danger-color);
        }
        #ai-instructions p {
            color: #991b1b;
        }
        #ai-instructions ol {
            padding-left: 25px;
            margin-top: 15px;
        }
        #ai-instructions li {
            margin-bottom: 12px;
            line-height: 1.6;
            color: #b91c1c; /* Koyu kırmızı metin */
        }
        #ai-instructions code {
            background-color: #fee2e2;
            color: #991b1b;
            font-weight: 600;
        }
        
    </style>
</head>
<body>

    <main>
        <header>
            <h1>Proje Dökümantasyonu: Arçelik Denetim Formu</h1>
            <p>PocketBase destekli, modüler denetim ve yönetim web uygulaması.</p>
        </header>

        <div id="ai-instructions">
            <h2><i class="fas fa-robot"></i> Yapay Zeka İçin Talimatlar (Sürüm Takibi)</h2>
            <p><strong>Bu döküman bir yapay zekaya yüklendiğinde, öncelikle bu bölüm okunmalıdır.</strong></p>
            <p>Proje Sürümü: <strong>v1.0.35</strong></p>
            
            <ol>
                <li>Bu dökümanı yüklediğimde ilk olarak bu bölümü incele. Tüm yapıyı analiz et ve anladığını doğrula.</li>
                <li>Dökümana versiyon numarası ekle. Herhangi bir güncelleme yapıldığında versiyon numarası buna göre güncellensin. (Mevcut: v1.0.35)</li>
                <li><strong>KURAL: Dökümanı "Canlı" Tut (BAĞLAYICI):</strong> Bu döküman bir "değişiklik günlüğü" (changelog) değildir. <strong>Sistemin o anki çalışan son halini</strong> tek doğru kaynak olarak yansıtır. Herhangi bir özellik eklendiğinde, çıkarıldığında veya davranışı değiştiğinde <strong>yeni madde, not veya başlık eklenmez</strong>; ilgili mevcut madde <strong>güncel ve doğru çalışma mantığını</strong> yansıtacak şekilde yerinde güncellenir. README her zaman sistemin o anki tek doğru tarifidir.</li>
                <li>Bir özellik eklendiğinde, dökümana "yeni özellik eklendi" yazmak yerine, o özelliği sistemin bir parçası olarak ilgili bölüme işle.</li>
                <li>Bir hata düzeltildiğinde, "hata düzeltildi" notu düşme; ilgili modülün çalışma mantığını düzeltilen (doğru) haliyle güncelle.</li>
                <li>Herhangi bir şey güncellendiğinde veya çıkartıldığında dosyadaki kodların tamamı güncellenerek yazılsın.</li>
                <li>Güncelleme yapıldığında eğer birden çok dosya güncellenmesi gerekiyorsa dosyaları ikişer ikişer iste.</li>
                <li>İstediğim güncelleme hangi dosyayı ilgilendiriyorsa o dosyayı iste, projenin tamamını isteme.</li>
                <li><strong>DOSYA VE KLASÖR YAPISI KONTROLÜ (ÇOK ÖNEMLİ):</strong> Herhangi bir kod yazmadan önce mutlaka dökümandaki "Klasör ve Dosya Yapısı" bölümüne bak. Eğer CSS değişikliği yapılacaksa ve ilgili yapıda bir CSS dosyası varsa (örn: <code>style.css</code> veya modüle ait <code>.css</code>), kodları SADECE o dosyaya yaz. HTML içine stil gömme.</li>
                <li><strong>SADECE MEVCUT DOSYALAR:</strong> Asla kendi başına yeni dosya oluşturma veya ekstra kod yazma. Sadece benden ilgili dosyaları iste ve benim yüklediğim "var olan" dosyalar üzerinde düzenleme yap.</li>
                <li>Ben herhangi bir güncelleme ya da özellik çıkartılmasını istiyorsam talimatı yazacağım, anladığını söyleyeceksin ve ben <code>başla</code> dediğimde başlayacaksın. Ben <code>başla</code> demezsem başlama.</li>
                <li>Herhangi bir güncelleme istersem ya da özelliğin çıkartılmasını istersem tüm dosyaları analiz et ve hiçbir kod kalıntısı bırakma.</li>
                <li><strong>Temiz Kod ve Ölü Kod Temizliği:</strong> Zamanla yapılan güncellemelerden sonra devre dışı bırakılan kodları (eski fonksiyonlar, kullanılmayan değişkenler) "yorum satırı" haline getirip dosyada bırakma. Bu kodları <strong>tamamen sil</strong>.</li>
                <li><strong>Mantıksal İyileştirme (Basitleştirme):</strong> Kod mantığını her zaman en sade ve performanslı olacak şekilde kurgula.</li>
                <li><strong>HER İŞLEM ÖNCESİ DOSYA TALEBİ (KRİTİK):</strong> Herhangi bir özellik ekleme, güncelleme, silme veya düzeltme isteği geldiğinde; ilgili dosyaları benden <strong>mutlaka tekrar iste</strong>. <strong>Eğer yapılacak işlem arayüzde (HTML) görsel bir değişiklik içeriyorsa, tasarımın bütünlüğü için ilgili <code>.css</code> dosyasını da mutlaka talep et.</strong> Dosyalar sohbet geçmişinde daha önce paylaşılmış olsa bile, benden güncel hallerini istemeden ve ben yüklemeden asla kod yazmaya başlama.</li>
                <li><strong>GÜVENLİ DOM ERİŞİMİ (KRİTİK):</strong> Herhangi bir JavaScript kodu yazarken, bir elemente müdahale etmeden önce o elementin DOM'da var olduğunu (<code>null</code> olmadığını) mutlaka kontrol et.</li>
                <li><strong>BÜTÜNSEL İŞ MANTIĞI ANALİZİ (ZORUNLU):</strong> Dosyalar paylaşıldığında sadece kod satırlarına odaklanma; <strong>uygulamanın fonksiyonel amacını</strong> ve veri alanları arasındaki <strong>mantıksal hiyerarşiyi</strong> (örn: Bölge -> Yönetmen -> Şehir bağımlılığı) bizzat analiz et. Bir güncelleme yaparken bu bağımlılıkları koru ve değişikliğin etkilediği tüm bileşenleri <strong>zincirleme (cascading)</strong> olarak güncelle.</li>
                <li><strong>STİL SENKRONİZASYONU (RACE CONDITION) KORUMASI:</strong> Modüler sistemde JS kodları CSS yüklenmeden önce çalışabilir. Görsel bozulmaları önlemek için; JS başlangıcına tarayıcının stilleri işlemesine izin verecek kısa bir <code>setTimeout</code> (50ms) ekle ve CSS seçicilerini modül ID'si ile güçlendir.</li>
                
                <li><strong>README GÜNCELLEME FORMATI (ZORUNLU):</strong> <code>readme.html</code> güncellemeleri varsayılan olarak <strong>DIFF/PATCH</strong> formatında yapılır.
                    <ul>
                        <li><strong>DIFF:</strong> Sadece değişen satır/bloklar “eski → yeni” şeklinde verilir.</li>
                        <li><strong>PATCH:</strong> “Şu bloğu bul → bununla değiştir” gibi uygulanabilir talimat verilir.</li>
                        <li><strong>TAM DOSYA:</strong> Sadece kullanıcı açıkça “tam dosya ver” derse, dosyanın tamamı eksiksiz üretilir.</li>
                    </ul>
                </li>
<li><strong>DÖKÜMAN GÜNCELLEME ONAYI:</strong> İstenilen tüm kodlama ve güncelleme işlemleri bittiğinde, bana <strong>"Dökümanı güncellemek ister misiniz?"</strong> diye sor. Ben <strong>"güncelle"</strong> diyene kadar <code>readme.html</code> dosyasında herhangi bir değişiklik yapma.</li>
            
                <li><strong>PROSEDÜR (ZORUNLU):</strong> Herhangi bir kod, mantık veya davranış değişikliği tamamlandığında, <code>readme.html</code> dosyası güncellenmeden önce kullanıcıya <strong>“Dökümanı güncellemek ister misiniz?”</strong> sorusu sorulur; kullanıcı açıkça onay vermeden dokümanda değişiklik yapılmaz.</li>
</ol>
<hr>
<h3><i class="fas fa-shield-alt"></i> ZORUNLU TESLİM FORMATI (Düzeltici Prompt)</h3>
<p><strong>Aşağıdaki kurallar bağlayıcıdır. Uymayan çıktı geçersizdir.</strong></p>
<ul>
    <li><strong>TAM DOSYA:</strong> Çıktı <code>&lt;!DOCTYPE html&gt;</code> ile başlamalı ve <code>&lt;/html&gt;</code> ile bitmelidir.</li>
    <li><strong>EKSİLTME YASAĞI:</strong> Hiçbir bölüm kısaltılamaz, özetlenemez, atlanamaz. <code>...</code> yasaktır.</li>
    <li><strong>BÜTÜNLÜK:</strong> Güncelleme sadece ilgili mevcut bölümlerde yapılır, diğer tüm <code>&lt;section id="..."&gt;</code> bölümleri birebir korunur.</li>
    <li><strong>CHANGELOG YOK:</strong> Yeni madde ekleme; doğru çalışma mantığını yerinde güncelle.</li>
    <li><strong>DOĞRULAMA:</strong> Güncelleme sonrası <code>&lt;!DOCTYPE html&gt;</code>, <code>&lt;/html&gt;</code> ve ana section sayısı raporlanmalıdır.</li>
    <li><strong>ÇIKTI LİMİTİ:</strong> Tek parça mümkün değilse <code>&lt;!-- PART x/y --&gt;</code> şeklinde parça parça verilir; son parça <code>&lt;/html&gt;</code> ile biter.</li>

<hr>
<h3><i class="fas fa-ban"></i> ÖZETLEME / SADELEŞTİRME YASAĞI (KRİTİK EK)</h3>

<p>
Bu doküman <strong>overview, özet veya tanıtım dokümanı değildir</strong>.
Her <code>&lt;section id="..."&gt;</code> bölümü <strong>zorunlu ve bağlayıcıdır</strong>.
</p>

<ul>
    <li><strong>SECTION KAYBI YASAKTIR:</strong> Orijinal dokümandaki herhangi bir
        <code>&lt;section id="..."&gt;</code> bloğunun silinmesi, kısaltılması veya atlanması
        <strong>HATALI ÇIKTI</strong> sayılır.</li>

    <li><strong>SECTION SAYISI KONTROLÜ (ZORUNLU):</strong>
        Güncelleme sonrası yapay zeka aşağıdaki bilgileri raporlamak zorundadır:
        <ul>
            <li>Orijinal section sayısı</li>
            <li>Güncel section sayısı</li>
            <li>Sayım eşleşmiyorsa çıktı <strong>GEÇERSİZDİR</strong></li>
        </ul>
    </li>

    <li><strong>OVERVIEW MODU YASAK:</strong>
        Yapay zeka bu dokümanı yeniden yazamaz, sadeleştiremez veya “daha okunur” hâle getiremez.
        Sadece <strong>yerinde güncelleme</strong> yapabilir.</li>

    <li><strong>DETAY GEREKSİZ SAYILAMAZ:</strong>
        “Uzun”, “detay”, “advanced”, “deep” gibi gerekçelerle hiçbir bölüm atlanamaz.</li>

    <li><strong>EKSİK ÇIKTI DAVRANIŞI:</strong>
        Herhangi bir bölüm eksikse, yapay zeka bunu başarısız çıktı olarak işaretlemeli
        ve kendiliğinden yeniden üretim önermelidir.</li>
</ul>

<hr>
<h3><i class="fas fa-brain"></i> MODEL-BAĞIMSIZ AI SÖZLEŞMESİ (GENEL)</h3>

<p>
Bu bölüm; <strong>Gemini, ChatGPT, Claude, DeepSeek</strong> ve gelecekte kullanılacak
<strong>tüm yapay zeka araçları</strong> için geçerlidir. Model, sağlayıcı veya sürüm fark etmeksizin
aşağıdaki kurallar bağlayıcıdır.
</p>

<ul>
    <li><strong>MODEL BAĞIMSIZLIK:</strong> Yapay zeka, kendi model sınırlamalarını (token limiti, özetleme eğilimi vb.) gerekçe göstererek içerik atlayamaz.</li>
    <li><strong>YENİDEN YAZMA YASAĞI:</strong> Bu doküman baştan yazılamaz. Sadece talep edilen değişiklikler yerinde uygulanır.</li>
    <li><strong>OKU → KARŞILAŞTIR → YAZ:</strong> Yapay zeka, önce mevcut dosyayı eksiksiz okuduğunu, ardından neyi değiştirdiğini bildiğini ve sadece bu farkları uyguladığını varsaymalıdır.</li>
    <li><strong>ÇIKTI DENETİMİ:</strong> Yapay zeka, çıktının eksiksiz olduğunu varsaymak yerine kontrol etmekle yükümlüdür.</li>
    <li><strong>HATA = DUR:</strong> Emin olunmayan hiçbir durumda tahmini çıktı üretilmez. Yazma durdurulur ve kullanıcıdan talimat istenir.</li>
    <li><strong>ÖZET / SADELEŞTİRME MODU YASAK:</strong> “Daha okunur”, “daha kısa”, “optimize” gerekçeleriyle metin değiştirilemez.</li>
    <li><strong>İHLAL SONUCU:</strong> Bu kurallara uymayan her çıktı otomatik olarak <strong>geçersiz</strong> sayılır.</li>
</ul>

<p>
Bu sözleşme, yapay zekanın “yardımcı” değil <strong>uygulayıcı</strong> rolünde olduğunu varsayar.
</p>

<hr>
<h3><i class="fas fa-stop-circle"></i> FAIL-FAST PROTOKOLÜ (ZORUNLU)</h3>

<p>
Yapay zeka, bu doküman üzerinde işlem yaparken <strong>en ufak bir belirsizlik</strong>,
eksik bağlam, dosya parçası, token limiti veya bölüm sayısı uyuşmazlığı tespit ederse
<strong>derhal yazmayı DURDURMAK zorundadır</strong>.
</p>

<ul>
    <li><strong>HTML ÜRETİMİ YASAK:</strong> Fail-fast tetiklendiğinde hiçbir HTML çıktısı verilmez.</li>
    <li><strong>SADECE HATA BİLDİR:</strong> Yapay zeka yalnızca hangi bilginin eksik olduğunu açıkça belirtir.</li>
    <li><strong>TAHMİN YASAĞI:</strong> Eksik bilgi “varsayım” ile doldurulamaz.</li>
</ul>

<hr>
<h3><i class="fas fa-clipboard-check"></i> ZORUNLU SELF-CHECK RAPORU</h3>

<p>
Güncelleme tamamlandıktan sonra, yapay zeka çıktının <strong>sonuna</strong>
aşağıdaki kontrol raporunu eklemek zorundadır:
</p>

<pre>
SELF-CHECK RAPORU
- <!DOCTYPE html> mevcut mu? : EVET/HAYIR
- </html> mevcut mu? : EVET/HAYIR
- Toplam section sayısı (orijinal): X
- Toplam section sayısı (çıktı): Y
- Section listesi birebir mi? : EVET/HAYIR
- Herhangi bir bölüm kısaltıldı mı? : EVET/HAYIR

Eğer herhangi bir cevap HAYIR ise çıktı GEÇERSİZDİR.
</pre>

<p>
Bu rapor eklenmeden verilen çıktılar <strong>otomatik olarak reddedilir</strong>.
</p>
</ul>

        </div>
        <section id="introduction">
            <h2><i class="fas fa-rocket"></i> Giriş ve Teknoloji Yığını</h2>
            <p>
                Bu proje, Arçelik denetim uzmanlarının saha ve dijital denetimlerini (FiDe/DiDe) gerçekleştirmeleri için tasarlanmış, <strong>PocketBase (Backend-as-a-Service)</strong> destekli modern bir web uygulamasıdır.
            </p>
            <p>
                Uygulama iki ana bileşenden oluşur:
            </p>
            <ul>
                <li><strong>Denetçi Arayüzü (Ana Form):</strong> Denetçilerin bayileri seçip denetim formlarını doldurduğu, anlık otomatik kayıt yapan ve e-posta taslağı oluşturan ana arayüz.</li>
                <li><strong>Yönetim Paneli (Admin):</strong> Bayilerin, kullanıcıların, denetim sorularının ve veritabanının yönetildiği modüler yönetici arayüzü.</li>
            </ul>

            <h3>Teknoloji Yığını</h3>
            <table>
                <thead>
                    <tr>
                        <th>Kategori</th>
                        <th>Teknoloji</th>
                        <th>Açıklama</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Veritabanı & Backend</strong></td>
                        <td><code>PocketBase</code></td>
                        <td>Tüm veritabanı, kimlik doğrulama (auth) ve dosya depolama işlemleri için kullanılır.</td>
                    </tr>
                    <tr>
                        <td><strong>Ön Yüz (Frontend)</strong></td>
                        <td><code>Vanilla JavaScript (ES6+ Modülleri)</code></td>
                        <td>Proje, herhangi bir framework (React, Vue vb.) kullanmadan, modern ES6 modül yapısı (<code>import</code>/<code>export</code>) ile yazılmıştır.</td>
                    </tr>
                    <tr>
                        <td rowspan="3"><strong>Temel Kütüphaneler</strong></td>
                        <td><code>PocketBase.js</code></td>
                        <td>PocketBase sunucusu ile iletişim için resmi JavaScript SDK'sı.</td>
                    </tr>
                    <tr>
                        <td><code>XLSX.js (SheetJS)</code></td>
                        <td>Excel dosyalarını okumak (DiDe/FiDe Puanları, Bayi Listesi, Styling Listesi) ve yazmak (Raporlama) için kullanılır.</td>
                    </tr>
                    <tr>
                        <td><code>Quill.js</code></td>
                        <td>Yönetim panelindeki "E-posta Taslağı" modülünde zengin metin (rich text) editörü sağlamak için kullanılır.</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="architecture">
            <h2><i class="fas fa-sitemap"></i> Proje Mimarisi</h2>
            <p>
                Proje, iki ana giriş noktasına sahip modüler bir yapı kullanır. Bu yapı, denetçi (client) ve yönetici (admin) işlevlerini net bir şekilde ayırır.
            </p>
            
            <h3>1. Denetçi Arayüzü (<code>index.html</code>)</h3>
            <p>
                Kullanıcının ana giriş noktasıdır. <code>main.js</code> dosyası tarafından başlatılır. Tüm işlevsellik (<code>api.js</code>, <code>ui.js</code>, <code>store.js</code> vb.) ES6 modülleri aracılığıyla <code>main.js</code>'e aktarılır.
            </p>
            <ul>
                <li><strong>Başlatma:</strong> <code>main.js</code>, <code>db-config.js</code>'den PocketBase URL'ini alarak veritabanı bağlantısını (<code>pb</code>) başlatır.</li>
                <li><strong>Kimlik Doğrulama:</strong> <code>api.js</code> üzerinden <code>loginUser</code> fonksiyonu ile güvenli giriş yapılır. Bu giriş, <code>is_banned</code> (hesap kilidi), <code>mobile_access</code> (mobil izin) ve <code>user_devices</code> (cihaz limiti) kontrollerini içerir.</li>
                <li><strong>Veri Yükleme:</strong> Giriş başarılıysa, <code>api.loadInitialData</code> fonksiyonu tüm gerekli verileri (Sorular, Bayiler, Excel verileri) çeker.</li>
                <li><strong>Arayüz Oluşturma:</strong> <code>ui.buildForm</code>, <code>ayarlar</code> tablosundan çekilen sorulara (<code>fideQuestionsData</code>) göre formu dinamik olarak HTML'e dönüştürür.</li>
                <li><strong>Excel İşleme (Sihirbaz):</strong> <code>excel.js</code>, yüklenen dosyaların yapısını analiz eder. Dosya formatı değişse bile "Eşleştirme Sihirbazı" sayesinde kullanıcı sütunları manuel seçebilir ve bu ayarlar buluta kaydedilir.</li>
                <li><strong>Anlık Güvenlik:</strong> <code>api.subscribeToRealtimeChanges</code> fonksiyonu, kullanıcının <code>users</code> ve <code>user_devices</code> kayıtlarını anlık olarak dinler. Eğer bir yönetici kullanıcıyı banlarsa veya cihazı kilitlerse, kullanıcı anında sistemden atılır (<code>utils.js -> showLockoutOverlay</code>).</li>
                <li><strong>Otomatik Kayıt:</strong> Formda yapılan her değişiklik (yazı yazma, kutu işaretleme), <code>ui.js</code> içindeki <code>debouncedSaveFormState</code> fonksiyonu sayesinde 800ms gecikmeyle otomatik olarak <code>api.saveFormState</code> aracılığıyla veritabanına kaydedilir.</li>
            </ul>

            <h3>2. Yönetim Paneli (<code>admin/admin.html</code>)</h3>
            <p>
                Yöneticinin giriş noktasıdır. <code>admin/admin.js</code> dosyası tarafından başlatılır. Bu dosya, temel bir "modül yükleyici" (module loader) görevi görür.
            </p>
            <ul>
                <li><strong>Rol Kontrolü:</strong> <code>admin.js</code>, giriş yapan kullanıcının rolünü (<code>admin</code> veya <code>client</code>) kontrol eder.</li>
                <li><strong>Dinamik Menü:</strong> <code>admin</code> rolü tüm modülleri görürken, <code>client</code> rolü (denetim uzmanı) yalnızca "Denetim Takip" modülünü görür.</li>
                <li><strong>Modül Yükleme:</strong> Menüden bir modül seçildiğinde, <code>admin.js</code> içindeki <code>loadModule</code> fonksiyonu çalışır. Bu fonksiyon, JavaScript'in dinamik <code>import()</code> özelliğini kullanarak <code>/modules/MODUL_ADI/</code> klasöründen ilgili <code>.html</code>, <code>.css</code> ve <code>.js</code> dosyalarını çeker ve ana panele enjekte eder.</li>
            </ul>
        </section>

        <section id="schema">
            <h2><i class="fas fa-database"></i> Veritabanı Şeması (PocketBase)</h2>
            <p>Kod analizi ve işlevselliğe dayalı olarak çıkarılan PocketBase koleksiyon (tablo) yapısı:</p>
            <table>
                <thead>
                    <tr>
                        <th>Koleksiyon (Tablo)</th>
                        <th>Önemli Alanlar (Alan Tipi)</th>
                        <th>Açıklama</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><code>users</code></td>
                        <td>
                            <code>name</code> (text)<br>
                            <code>role</code> (select: 'admin' | 'client')<br>
                            <code>mobile_access</code> (bool)<br>
                            <code>device_limit</code> (number)<br>
                            <code>is_banned</code> (bool)
                        </td>
                        <td>Sisteme giriş yapan kullanıcılar. <code>role</code> admin paneli erişimini belirler. <code>is_banned</code> anlık hesap kilididir. <code>device_limit</code> bireysel cihaz sınırıdır.</td>
                    </tr>
                    <tr>
                        <td><code>bayiler</code></td>
                        <td>
                            <code>bayiKodu</code> (text, <i>Unique</i>)<br>
                            <code>bayiAdi</code> (text)<br>
                            <code>bolge</code>, <code>sehir</code>, <code>ilce</code> (text)<br>
                            <code>yonetmen</code> (text)<br>
                            <code>email</code> (email)<br>
                            <code>sorumlu_kullanici</code> (relation &rarr; <code>users</code>)
                        </td>
                        <td>Denetlenecek tüm bayi kayıtları. <code>sorumlu_kullanici</code>, bayinin hangi denetçiye (client) atandığını belirler.</td>
                    </tr>
                    <tr>
                        <td><code>denetim_raporlari</code></td>
                        <td>
                            <code>bayi</code> (relation &rarr; <code>bayiler</code>)<br>
                            <code>user</code> (relation &rarr; <code>users</code>)<br>
                            <strong><code>soruDurumlari</code> (json)</strong><br>
                            <code>denetimTamamlanmaTarihi</code> (date)
                        </td>
                        <td><strong>Projenin çekirdek verisidir.</strong> Denetçilerin kaydettiği tüm cevaplar <code>soruDurumlari</code> JSON nesnesinde saklanır (Örn: <code>{"16": {"subCategoryQty": "3", ...}}</code>).</td>
                    </tr>
                    <tr>
                        <td><code>user_devices</code></td>
                        <td>
                            <code>user</code> (relation &rarr; <code>users</code>)<br>
                            <code>device_key</code> (text, <i>Unique</i>)<br>
                            <code>device_info</code> (text)<br>
                            <code>is_locked</code> (bool)<br>
                            <code>last_login</code> (date)
                        </td>
                        <td>Kullanıcıların giriş yaptığı cihazların kaydı. <code>is_locked</code> (True ise) o cihazdan girişi anlık olarak engeller. <code>last_login</code> son erişim zamanını tutar.</td>
                    </tr>
                    <tr>
                        <td><code>ayarlar</code></td>
                        <td>
                            <code>anahtar</code> (text, <i>Unique</i>)<br>
                            <code>deger</code> (json | text | number)
                        </td>
                        <td>Global ayarlar için bir Anahtar-Değer (Key-Value) tablosu. <strong>Sorular (<code>fideQuestionsData</code>)</strong>, E-posta şablonu, <strong>Excel Eşleştirme Ayarları (<code>excel_mapping_dide/fide</code>)</strong> burada saklanır.</td>
                    </tr>
                    <tr>
                        <td><code>excel_verileri</code></td>
                        <td>
                            <code>tip</code> (select: 'dide' | 'fide')<br>
                            <code>dosyaAdi</code> (text)<br>
                            <code>veri</code> (json)
                        </td>
                        <td>Yönetim panelinden yüklenen DiDe ve FiDe Excel puanlarının JSON olarak saklandığı yer. <code>dosyaAdi</code> orijinal dosya adıdır.</td>
                    </tr>
                    <tr>
                        <td><code>denetim_geri_alinanlar</code></td>
                        <td>
                            <code>bayi</code> (relation &rarr; <code>bayiler</code>)<br>
                            <code>yil_ay</code> (text)
                        </td>
                        <td>"Denetim Takip" modülünde "Geri Al" yapılan denetimlerin kaydını tutar. Sayaçları düzeltmek için kullanılır.</td>
                    </tr>
                </tbody>
            </table>
        </section>

        <section id="file-structure">
            <h2><i class="far fa-folder-open"></i> Klasör ve Dosya Yapısı</h2>
            <p>Projenin tam dosya hiyerarşisi ve her dosyanın birincil sorumluluğu:</p>
<pre>
/ (Ana Dizin)
├── <strong>admin/</strong>
│   ├── admin.html          <em>(Yönetim paneli ana iskeleti/kabuğu)</em>
│   ├── admin.css           <em>(Panel iskeletinin stili)</em>
│   └── <strong>admin.js</strong>            <em>(Panel modül yükleyicisi ve admin/client rol kontrolü)</em>
│
├── <strong>modules/</strong>
│   ├── <strong>bayi-yoneticisi/</strong>
│   │   └── bayi-yoneticisi.html, .css, .js     <em>(Bayiler koleksiyonu için CRUD, Excel İçe/Dışa Aktarma)</em>
│   ├── <strong>denetim-takip/</strong>
│   │   └── denetim-takip.html, .css, .js     <em>(Denetim ilerleme paneli (dashboard) ve periyot tabanlı filtreleme)</em>
│   ├── <strong>eposta-taslagi/</strong>
│   │   └── eposta-taslagi.html, .css, .js    <em>(Quill.js editörü ile e-posta şablonu yönetimi)</em>
│   ├── <strong>kullanici-yoneticisi/</strong>
│   │   └── kullanici-yoneticisi.html, .css, .js  <em>(Users koleksiyonu için CRUD, rol, ban ve cihaz yönetimi)</em>
│   ├── <strong>soru-yoneticisi/</strong>
│   │   └── soru-yoneticisi.html, .css, .js     <em>(Ana denetim soruları (fideQuestionsData) yönetimi, 'Senaryo Sistemi')</em>
│   └── <strong>veritabani-yonetim/</strong>
│       └── veritabani-yonetim.html, .css, .js  <em>(Yıkıcı temizlik işlemleri ve Excel ayarlarını sıfırlama)</em>
│
├── <strong>index.html</strong>              <em>(Ana denetim formu - Excel Eşleştirme Modalı içerir)</em>
├── style.css               <em>(Ana form ve Modal stilleri)</em>
├── db-config.js            <em>(PocketBase bağlantı URL'sini içerir)</em>
├── <strong>main.js</strong>                 <em>(Uygulama başlatıcısı ve popup giriş mantığı - Client)</em>
├── state.js                <em>(Global uygulama durumu yönetimi - Client)</em>
├── <strong>api.js</strong>                  <em>(Tüm PocketBase veritabanı işlemleri ve güvenlik kontrolleri - Client)</em>
├── <strong>ui.js</strong>                   <em>(Kullanıcı arayüzü (DOM) oluşturma ve yönetimi - Client)</em>
├── <strong>excel.js</strong>                <em>(Excel okuma, Eşleştirme Sihirbazı, Bulut Kaydı - Client)</em>
├── store.js                <em>(Bayi arama ve seçme mantığı - Client)</em>
└── utils.js                <em>(Genel yardımcı fonksiyonlar, örn: showLoadingOverlay)</em>
</pre>
        </section>

        <section id="module-analysis">
            <h2><i class="fas fa-cogs"></i> Modül ve Dosya Analizi</h2>
            
            <h3>Grup 1: Ana (Client) Arayüzü (Kök Dizin <code>/</code>)</h3>
            <ul>
                <li><code>main.js</code> (Başlatıcı): <code>initializeApp</code> fonksiyonu ile uygulamayı başlatır. PocketBase'i (<code>pb</code>) ilklendirir. <code>api.loadInitialData</code> ile tüm verileri yükler, <code>ui.buildForm</code> ile formu çizer. <code>api.subscribeToRealtimeChanges</code> ile anlık güvenlik dinlemesini başlatır.</li>
                <li><code>api.js</code> (Veri Katmanı): <strong>Tüm PocketBase iletişiminin merkezidir.</strong>
                    <ul>
                        <li><code>loginUser(email, password)</code>: Güvenli giriş yapar. <code>is_banned</code>, <code>mobile_access</code> ve <code>user_devices</code> (bireysel limit) kontrollerini içerir.</li>
                        <li><code>loadInitialData()</code>: Gerekli tüm verileri (Bayiler, Sorular, Ayarlar, Excel Verileri, Aylık Denetimler) çeker.</li>
                        <li><code>loadReportForStore(bayiKodu)</code>: Seçilen bayi için kaydedilmiş <code>denetim_raporlari</code> verisini çeker.</li>
                        <li><code>saveFormState(reportData, isFinalizing)</code>: Formdaki verileri <code>denetim_raporlari</code> koleksiyonuna kaydeder/günceller. <code>isFinalizing</code> True ise <code>denetimTamamlanmaTarihi</code> alanını da ekler.</li>
                        <li><code>subscribeToRealtimeChanges()</code>: <code>users</code> (ban için) ve <code>user_devices</code> (lock için) koleksiyonlarını dinler. Bir yönetici bu kayıtlarda değişiklik yaparsa, kullanıcıyı sistemden atar.</li>
                    </ul>
                </li>
                
                <li><code>excel.js</code> (Excel İşleme & Sihirbaz): <strong>DiDe ve FiDe dosyalarını dinamik okuyan modüldür.</strong>
                    <ul>
                        <li><strong>Excel Eşleştirme Sihirbazı:</strong> Dosya formatı değiştiğinde veya ilk kez yüklendiğinde, kullanıcıya bir pencere (modal) açar. Kullanıcıdan başlık satırını ve sütunları seçmesini ister.</li>
                        <li><code>openMappingModal</code>: Sihirbaz penceresini açar ve kullanıcının seçimlerini yönetir.</li>
                        <li><code>checkSavedMapping</code>: Dosyanın yapısını (imzasını) kontrol eder. Eğer dosya yapısı daha önce kaydedilmiş ayarlarla (<code>ayarlar</code> tablosunda) uyuşuyorsa, sihirbazı açmadan otomatik işler.</li>
                        <li><code>saveMappingToCloud</code>: Kullanıcının yaptığı eşleştirme ayarlarını buluta kaydeder.</li>
                        <li><strong>Bayi Kodu Tip Güvenliği:</strong> Excel'den okunan bayi kodu değerleri, sayı/metin tip uyuşmazlığından kaynaklanan eşleşmeme sorunlarını önlemek için işleme sırasında <code>String(...)</code> ile metne sabitlenir (DiDe ve FiDe için).</li>
                        <li><code>processDideExcelData</code> / <code>processFideExcelData</code>: Eşleştirme kurallarına göre veriyi işler. FiDe için yıl (örn: 2025) satırının altındaki sütun başlıklarını okuma zekasına sahiptir.</li>
                    </ul>
                </li>

                <li><code>ui.js</code> (Arayüz Katmanı): <strong>Tüm HTML oluşturma ve DOM manipülasyonu buradadır.</strong>
                    <ul>
                        <li><code>buildForm()</code>: <code>state.fideQuestions</code> dizisini döngüye alarak <code>generateQuestionHtml</code>'i çağırır.</li>
                        <li><code>generateQuestionHtml(q)</code>: Soru tipine (<code>q.type</code>) göre (<code>standard</code>, <code>product_list</code>, <code>pop_system</code>, <code>styling_list</code>) farklı HTML yapısı oluşturur.
                            <ul>
                                <li><code>styling_list</code>: "Hibrit Mod" olarak çalışır. Hem açılır menüden kategori/ürün seçimi yapılabilir hem de "Yeni Eksik Ekle" butonu ile serbest metin girişi (not) eklenebilir.</li>
                            </ul>
                        </li>
                        <li><code>getFormDataForSaving()</code>: Formdaki tüm cevapları okur ve JSON nesnesine dönüştürür.
                            <ul>
                                <li><code>styling_list</code> için: Seçilen ürünler (<code>selectedProducts</code>), kategori seçimleri (<code>stylingCategorySelections</code>) ve manuel girilen notlar (<code>dynamicInputs</code>) kaydedilir.</li>
                            </ul>
                        </li>
                        <li><code>generateEmail()</code>: E-posta taslağını oluşturur. <code>styling_list</code> tipi sorularda sıralama şöyledir:
                            <ol>
                                <li>Statik Açıklama Metni (Sirkü linki vb.)</li>
                                <li>Kullanıcının eklediği serbest notlar (Yeni Eksik Ekle verileri)</li>
                                <li>Otomatik hesaplanan ürün sipariş listesi</li>
                            </ol>
                            Ürün seçilmemiş olsa dahi, statik metin veya not varsa soru e-postaya dahil edilir.
                        
                            <p><strong>Güvenli Veri Kontrolü (Çökme Önleme):</strong> Seçilen bayi, yıl geçişi nedeniyle puanları sıfırlanmış olsa veya ilgili Excel listesinde hiç bulunmasa bile <code>generateEmail</code> akışı durmaz ve taslak e-posta her koşulda oluşturulur. Bu durumda; yönetmen adı <strong>öncelikle PocketBase bayi kaydındaki</strong> <code>bayiler.yonetmen</code> alanından alınır. Eğer bu bilgi yoksa Excel (DiDe) verisindeki <code>'Bayi Yönetmeni'</code> alanı yedek olarak kullanılır; hiçbir kaynakta bulunamazsa varsayılan <code>Yetkili</code> kullanılır. DiDe/FiDe puan tabloları <strong>sabit 12 aylık (Ocak-Aralık) formatta oluşturulur ve</strong> eksik değerler otomatik olarak <code>-</code> ile doldurulur.</p>
</li>
                    </ul>
                </li>
                <li><code>state.js</code> (Durum Yönetimi): <code>dideData</code>, <code>fideData</code>, <code>fideQuestions</code>, <code>selectedStore</code> gibi tüm uygulama tarafından kullanılan global değişkenleri tutar ve <code>set...</code> fonksiyonları ile güvenli bir şekilde güncellenmesini sağlar.</li>
                <li><code>store.js</code>: Bayi arama (<code>displayStores</code>) ve seçme (<code>selectStore</code>) mantığını içerir. Bir bayi seçildiğinde, <code>api.loadReportForStore</code>'u tetikler.</li>
                <li><code>utils.js</code>: Genel yardımcıları içerir. En önemlileri <code>showLoadingOverlay</code> (yükleniyor ekranı) ve <code>showLockoutOverlay</code> (kullanıcıyı kilitleyen kırmızı ekran).</li>
            </ul>

            <h3>Grup 2: Yönetim Paneli (<code>/admin</code> ve <code>/modules</code>)</h3>
            <ul>
                <li><code>admin/admin.js</code> (Modül Yükleyici):
                    <ul>
                        <li><code>initializeAdminPanel</code>: Kullanıcı rolünü (<code>admin</code>/<code>client</code>) kontrol eder.</li>
                        <li><code>renderModuleMenu</code>: Role göre menüyü dinamik olarak oluşturur (Client sadece <code>denetim-takip</code> görür).</li>
                        <li><code>loadModule(moduleId)</code>: <strong>Çekirdek fonksiyondur.</strong> Seçilen modülün <code>.html</code>'ini <code>fetch</code> ile, <code>.css</code>'ini <code>&lt;link&gt;</code> etiketi ekleyerek ve <code>.js</code>'ini dinamik <code>import()</code> ile yükler. Yüklenen JS'in <code>initialize[ModulAdi]Module(pb)</code> fonksiyonunu çağırır.</li>
                    </ul>
                </li>
                <li><code>modules/denetim-takip.js</code>:
                    <ul>
                        <li><code>loadMasterData()</code>: Role göre tüm verileri (Admin: tümü, Client: sadece kendi) <code>allStoresMaster</code>, <code>allReportsMaster</code> gibi ana listelere yükler.</li>
                        <li><code>applyDataFilterAndRunDashboard(viewId)</code>: Admin'in seçtiği görünüme ('Benim Verilerim', 'Genel Bakış' veya 'Diğer Kullanıcı') göre ana listeleri filtreleyerek <code>allStores</code>, <code>auditedStoreCodesCurrentMonth</code> gibi "Görünüm" listelerini doldurur.</li>
                        <li><strong>Periyot Yönetimi:</strong> Modül artık "Aylık" ve "Yıllık" olmak üzere iki farklı görünüm periyodunu destekler. Yıllık periyotta, bir bayinin yıl içinde bir kez denetlenmesi yeterli kabul edilir.</li>
                        <li><strong>Akıllı Filtreleme ve Hiyerarşi (KRİTİK):</strong>
                            <ul>
                                <li><strong>Zorunlu Daraltma:</strong> Herhangi bir üst filtre (Bölge) değiştiğinde, altındaki tüm açılır menüler (Yönetmen, Şehir, İlçe) anlık olarak süzülmeli ve hiyerarşi korunmalıdır.</li>
                                <li><strong>Zincirleme Güncelleme:</strong> Filtre değişimi anında tüm dashboard bileşenlerini (Sayaçlar, Listeler, İlerleme Çubukları) "VE" mantığıyla yeniden render etmelidir.</li>
                            </ul>
                        </li>
                        <li><code>runDashboard()</code>: Filtrelenmiş "Görünüm" listelerine ve aktif periyoda göre sayaçları ve listeleri çizer.</li>
                    </ul>
                </li>
                <li><code>modules/bayi-yoneticisi.js</code>:
                    <ul>
                        <li>Bayi CRUD işlemleri (<code>handleNewBayi</code>, <code>handleEditBayi</code>, <code>handleDeleteBayi</code>).</li>
                        <li><code>handleExportExcel</code>: XLSX.js kullanarak filtrelenmiş bayi listesini Excel'e aktarır.</li>
                        <li><code>executeImport</code>: <strong>Excel'den İçe Aktarma</strong> sihirbazının (<code>openImportModal</code>) son adımıdır. Sütun eşleştirmelerine göre <code>bayiler</code> koleksiyonunu toplu olarak günceller veya oluşturur.</li>
                        <li><code>executeBulkAssign</code>: <strong>Toplu Atama</strong> sihirbazının (<code>openBulkAssignModal</code>) son adımıdır. Filtrelenmiş (Bölge, Şehir vb.) "Atanmamış" bayilere seçilen denetim uzmanını (<code>sorumlu_kullanici</code>) atar.</li>
                    </ul>
                </li>
                <li><code>modules/kullanici-yoneticisi.js</code>:
                    <ul>
                        <li>Kullanıcı CRUD işlemleri (<code>handleNew</code>, <code>handleEdit</code>, <code>handleDelete</code>).</li>
                        <li><code>handleToggleBanUser</code>: Kullanıcının <code>users</code> koleksiyonundaki <code>is_banned</code> (Hesap Kilidi) bayrağını değiştirir.</li>
                        <li><code>handleToggleLockDevice</code>: <code>user_devices</code> koleksiyonundaki bir cihazın <code>is_locked</code> (Cihaz Kilidi) bayrağını değiştirir.</li>
                        <li>Form, kullanıcının rolü "client" ise bireysel <code>device_limit</code> (cihaz limiti) ayarını gösterir.</li>
                    </ul>
                    <p><strong>Stil Notu:</strong> “Kullanıcı Düzenle” ekranındaki <code>input</code> ve <code>select</code> alanlarının modern görünümü, modülün kendi CSS dosyasında (<code>modules/kullanici-yoneticisi/kullanici-yoneticisi.css</code>) <code>#user-form-view</code> scope’u ile tanımlanır. <code>admin.css</code> modül formları için genel bir form stili vermez; bu nedenle bu modül kendi kontrollerini stillendirir.</p>
                </li>

                <li><code>modules/soru-yoneticisi.js</code>:
                    <ul>
                        <li><code>renderQuestionManager</code>: <code>fideQuestions</code> dizisine göre soru yönetim arayüzünü oluşturur.</li>
                        <li><code>saveQuestions</code>: <strong>Çekirdek fonksiyondur.</strong> Arayüzdeki tüm değişiklikleri toplar (yeni sorular, ürün listeleri, styling hiyerarşisi dahil) ve tek bir JSON nesnesi olarak <code>ayarlar</code> koleksiyonundaki <code>fideQuestionsData</code> anahtarına kaydeder.</li>
                        <li><code>render...ManagerUI</code>: Soru tiplerine özel alt yönetim panellerini çizer.</li>
                        <li><code>parseStylingBulkData</code>: "Styling Listesi" yöneticisindeki Excel sihirbazını çalıştırır, hiyerarşik yapıyı oluşturur.</li>
                        <li><code>applyIdChangeScenario</code> / <code>applyDeleteQuestionScenario</code>: <strong>Hazır Senaryo Sistemi.</strong> Bu fonksiyonlar <code>updateAllReports</code>'u çağırarak <code>denetim_raporlari</code> kayıtlarını gezer ve cevapları günceller/siler.</li>
                    </ul>
                </li>
                <li><code>modules/eposta-taslagi.js</code>: Quill.js editörünü başlatır. <code>saveTemplateData</code> fonksiyonu, HTML içeriğini <code>ayarlar</code> koleksiyonuna kaydeder.</li>
                <li><code>modules/veritabani-yonetim.js</code>:
                    <ul>
                        <li>"Güvenli" ve "Yıkıcı" eylemler sunar.</li>
                        <li><code>handleDeleteUserAndData_Modal</code> (Güvenli): <strong>4 Adımlı Temizlik:</strong> Kullanıcıyı silmeden önce sırasıyla; raporlarını siler, bayilerini boşa çıkarır, cihazlarını temizler ve kullanıcıyı siler.</li>
                        <li><code>handleDeleteUnassignedBayis_Modal</code> (Yıkıcı): "Atanmamış" tüm bayileri siler. Bağlı raporları ve geri alınanları temizleyerek veritabanı hatasını önler.</li>
                        <li><code>deleteTable</code>: Bir koleksiyondaki tüm kayıtları toplu olarak siler.</li>
                        <li><strong>Excel Ayarlarını Sıfırla:</strong> Kayıtlı Excel sütun eşleştirmelerini silerek sihirbazın tekrar açılmasını sağlar.</li>
                    </ul>
                </li>
            </ul>
        </section>

        <section id="update-guide" class="update-guide">
            <h2><i class="fas fa-wrench"></i> Güncelleme ve Bakım Rehberi</h2>
            <p>Projeye gelecekte bir özellik eklerken veya güncelleme yaparken bu rehber, hangi dosyaların etkileneceğini anlamanıza yardımcı olacaktır.</p>
            <section id="auto-checklist">
                <h2><i class="fas fa-clipboard-check"></i> Otomatik Kontrol Checklisti (Değişiklik Sonrası)</h2>
                <p>
                    Bu bölüm bir changelog değildir. Amaç; bir değişiklikten sonra README’nin hâlâ <strong>tek doğru tarif</strong> olup olmadığını hızlıca doğrulamaktır.
                </p>

                <h3>1) Arayüz / UI Değiştiyse</h3>
                <ul>
                    <li>Bağlantı göstergesi, butonlar, metinler: README’de anlatım hâlâ birebir doğru mu?</li>
                </ul>

                <h3>2) Bulut / PocketBase / Auth Değiştiyse</h3>
                <ul>
                    <li>Bağlantı durumu göstergesi anlatımı doğru mu?</li>
                </ul>

                <h3>3) Excel İşleme / Eşleştirme Değiştiyse</h3>
                <ul>
                    <li>Bayi kodu tip güvenliği (String sabitleme) hâlâ uygulanıyor mu?</li>
                </ul>

                <h3>4) Soru Yapısı / Migration / Rapor Güncelleme Değiştiyse</h3>
                <ul>
                    <li>Question ID değişimi/silme akışı aynı mı?</li>
                </ul>

                <h3>5) E-posta Şablonu / Placeholder’lar Değiştiyse</h3>
                <ul>
                    <li>Placeholder sözleşmesi birebir aynı mı?</li>
                </ul>

                <h3>6) Admin Modülleri / Veritabanı Yönetimi Değiştiyse</h3>
                <ul>
                    <li><strong>Periyot Kontrolü:</strong> Periyot seçimleri listeleri doğru etkiliyor mu?</li>
                    <li><strong>Stil Kontrolü:</strong> Modül geçişlerinde buton tasarımları bozulmadan (stilsiz kalmadan) yükleniyor mu?</li>
                </ul>

                <h3>Bitiriş Kuralı</h3>
                <ul>
                    <li>Bir madde yanlışsa: <strong>Yeni başlık ekleme</strong> — mevcut maddeyi düzelt.</li>
                </ul>
            </section>


            <div class="info-box">
                <p><strong>Temel Kurallar (Kullanıcı Talimatları):</strong></p>
                <ul>
                    <li><strong>Kod Tekrarı Yapma:</strong> Yeni bir özellik eklerken, mevcut CSS sınıflarını veya JavaScript fonksiyonlarını tekrar kullan.</li>
                    <li><strong>Ölü Kodu Temizle:</strong> Bir özellik güncellendiğinde, eski fonksiyonları analiz edip sil.</li>
                    <li><strong>Sıralı Güncelleme:</strong> Birden fazla dosya güncelleniyorsa, dosyaları tek tek sağla.</li>
                </ul>
            </div>

            <h3>Senaryo 1: Yeni Bir Soru Tipi Ekleme</h3>
            <p>Yeni bir soru tipi eklemek, sistemin 6 farklı noktasını etkiler:</p>
            <ol>
                <li><strong>Soru Yöneticisi:</strong> <code>modules/soru-yoneticisi.js</code> içinde yeni <code>anket_tipi</code> seçeneği eklenmeli.</li>
                <li><strong>Denetçi Arayüzü:</strong> <code>ui.js</code> içinde HTML oluşturma ve veri okuma mantığı eklenmeli.</li>
                <li><strong>E-posta Taslağı:</strong> E-postada nasıl görüneceği belirlenmeli.</li>
            </ol>
            
            <h3>Senaryo 2: Excel İşleme Mantığını Değiştirme</h3>
            <ol>
                <li><strong>İşleme Mantığı:</strong> <code>excel.js</code> içindeki <code>processDideExcelData</code> incelenmeli.</li>
                <li><strong>Sihirbaz:</strong> Yeni bir sütun seçilecekse <code>openMappingModal</code> güncellenmeli.</li>
            </ol>
        </section>
    
        <section id="ai-health-check">
            <h2><i class="fas fa-heartbeat"></i> AI İçin Hızlı Sağlık Kontrolü (Health Check)</h2>
            <p>Bu bölüm, sistemin kritik güvenlik davranışlarını doğrulamak içindir:</p>

            <h3>Kontrol Listesi (Hızlı)</h3>
            <ul>
                <li><strong>Excel Bayi Kodu:</strong> <code>'Bayi Kodu'</code> her zaman <code>String(...)</code> ile sabitlenir.</li>
                <li><strong>Eksik Bayi Verisi:</strong> Bayi Excel'de yoksa bile e-posta taslağı üretimi devam eder.</li>
                <li><strong>Boş Puanlar:</strong> Skorlar boşsa hücreler <code>-</code> ile doldurulur.</li>
                <li><strong>Yönetmen Adı:</strong> Öncelikle PocketBase kaydından, yoksa Excel'den alınır.</li>
                <li><strong>Stil Senkronizasyonu:</strong> Modül geçişlerinde 50ms bekleme süresi ve güçlü CSS seçicileri ile bozuk görünüm (Race Condition) önlenmiştir.</li>
            </ul>
        </section>

        <section id="test-checklist">
            <h2><i class="fas fa-vial"></i> Gerçek Senaryolarla Test Checklisti (Güvenli Veri Kontrolü)</h2>
            <p>Bu testler, gerçek dünyadaki sorunları doğrulamak içindir:</p>

            <h3>Test 1: Yıl Geçişi</h3>
            <ol>
                <li>Yeni yıl için puanların boş olduğu durumda e-posta üret.</li>
                <li><strong>Beklenen:</strong> Eksik değerler <code>-</code> görünür.</li>
            </ol>

            <h3>Test 2: Eksik Bayi</h3>
            <ol>
                <li>Excel'de bulunmayan bir bayiyi seçip e-posta üret.</li>
                <li><strong>Beklenen:</strong> Sistem durmaz; taslak oluşur.</li>
            </ol>
        </section>


        <section id="project-contract">
            <h2><i class="fas fa-file-signature"></i> Proje Sözleşmesi (AI/Geliştirici İçin Bağlayıcı Kurallar)</h2>
            <p>
                Bu bölüm, README’nin nasıl canlı tutulacağını netleştirir:
            </p>
            <ul>
                <li><strong>Tek Kaynak:</strong> Bu doküman, çalışan sistemin son halini yansıtır. Kod değiştiyse, ilgili başlık da güncellenmelidir.</li>
                <li><strong>Changelog Yok:</strong> Doğru çalışma mantığı ilgili bölüme işlenir.</li>
                <li><strong>Dosya Disiplini:</strong> CSS değişikliği, ilgili <code>.css</code> dosyasına yazılır.</li>
                <li><strong>Hiyerarşi Koruma:</strong> Veri alanları arası mantıksal bağlar (Bölge -> Şehir vb.) her güncellemede korunmalıdır.</li>
            </ul>
        </section>

        <section id="client-deep">
            <h2><i class="fas fa-desktop"></i> Client (Ana Form) – Kritik Bağımlılıklar ve Sık Hatalar</h2>
            <h3>Inline <code>onclick</code> Bağımlılığı</h3>
            <p>
                <code>index.html</code> içindeki butonlar için UI fonksiyonlarının <code>window</code>’a bağlanması kritiktir.
            </p>

            <h3>Loading/Kilit Overlay Yapısı</h3>
            <p>
                <code>utils.js</code> içindeki overlay fonksiyonları DOM’da belirli ID’ler bekler.
            </p>
        </section>

        <section id="admin-deep">
            <h2><i class="fas fa-shield-halved"></i> Admin Panel Mimarisi (Detay)</h2>
            <h3>Rol Bazlı Yetkilendirme</h3>
            <p>
                Rol bazlı kontrol sadece menü gizleme değildir; <code>client</code> için modüller yüklenmez.
            </p>

            <h3>Modül Sözleşmesi (Zorunlu)</h3>
            <ul>
                <li>Dosyalar: <code>{id}.html</code>, <code>{id}.css</code>, <code>{id}.js</code></li>
                <li>JS içinde zorunlu export: <code>initialize{FormattedId}Module(pb)</code></li>
                <li><strong>Stil Güvenliği:</strong> JS içinde render işlemleri 50ms gecikmeli tetiklenmelidir.</li>
            </ul>
        </section>

        <section id="excel-deep">
            <h2><i class="fas fa-file-excel"></i> Excel Sistemi (Detay)</h2>
            <h3>Bayi Kodu Tip Güvenliği</h3>
            <p>
                Eşleşme hatalarını engellemek için bayi kodu <code>String(...)</code> ile metne sabitlenir.
            </p>
        </section>

        <section id="email-deep">
            <h2><i class="fas fa-envelope-open-text"></i> E-posta Şablon Motoru</h2>
            <h3>Placeholder Sözleşmesi (Birebir Yazım)</h3>
            <p>Client tarafı <code>{YONETMEN_ADI}</code>, <code>{BAYI_BILGISI}</code> vb. placeholder’ları birebir arar.</p>
        </section>

        <section id="questions-deep">
            <h2><i class="fas fa-code-branch"></i> Soru Sistemi & Migration (FiDe)</h2>
            <h3>Hazır Senaryo Sistemi</h3>
            <p>
                Soru ID değişimi veya silme işlemleri raporlardaki JSON verisini güncelleyen "Migration Engine" ile yapılır.
            </p>
        </section>

        <section id="security-deep">
            <h2><i class="fas fa-user-lock"></i> Güvenlik Modeli (Detay)</h2>
            <h3>Ban = Anlık Oturum Kesme</h3>
            <p>
                <code>users.is_banned</code> alanı anlık dinlenir; ban atıldığı anda oturum düşer.
            </p>
        </section>

        <section id="ops-deep">
            <h2><i class="fas fa-triangle-exclamation"></i> Operasyonel Kurtarma & Riskli İşlemler</h2>
            <h3>Geri Alma Mantığı</h3>
            <p>
                Raporu silmez; sayaçlardan düşürmek için <code>denetim_geri_alinanlar</code> koleksiyonuna kayıt atar.
            </p>
        </section>

        <section id="troubleshooting">
            <h2><i class="fas fa-bug"></i> Sorun Giderme: Nereye Bakmalıyım?</h2>
            <table>
                <thead>
                    <tr>
                        <th>Belirti</th>
                        <th>Muhtemel Sebep</th>
                        <th>Bakılacak Dosya/Bölüm</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Butonlar stilsiz görünüyor (Mavi/Beyaz)</td>
                        <td>Stil dosyası tam yüklenmeden JS çalışmış</td>
                        <td><code>initializeModule</code> fonksiyonundaki 50ms gecikme kontrol edilmeli.</td>
                    </tr>
                    <tr>
                        <td>"Veriler İşleniyor"da takılı kalıyor</td>
                        <td>Element bulunamadığı için JS çökmesi</td>
                        <td>JS içindeki Safe Access (Kural 16) uygulaması kontrol edilmeli.</td>
                    </tr>
                    <tr>
                        <td>Filtreler sonuç getirmiyor</td>
                        <td>Hiyerarşik bağ (Bölge-Yönetmen-Şehir) kopuk</td>
                        <td>Modül Referansı &rarr; denetim-takip (Akıllı Filtreleme).</td>
                    </tr>
                </tbody>
            </table>
        </section>


<section id="modules-reference">
  <h2><i class="fas fa-cubes"></i> Modül Referansı (Uçtan Uca Çalışma, Seçenekler ve Etkiler)</h2>
  <p>
    Bu bölüm, tüm modüllerin nasıl çalıştığını ve bir sorun durumunda nereden başlanacağını toplar.
  </p>

  <h3>Genel Kurallar (Tüm Modüller İçin Geçerli)</h3>
  <ul>
    <li>Her modül admin modül sözleşmesine uyar.</li>
    <li>Event listener’lar tekrar yüklemeyi önleyen guard mekanizmasına sahiptir.</li>
    <li><strong>Savunmacı Programlama:</strong> HTML elemanlarının varlığı kontrol edilir (Safe DOM Access).</li>
    <li><strong>Stil Güvenliği:</strong> Modül render edilmeden önce tarayıcıya tasarım dosyalarını (CSS) işlemek için 50ms süre tanınır.</li>
  </ul>

  <hr>

  <h3 id="mod-denetim-takip">denetim-takip</h3>
  <p><strong>Rol:</strong> Operasyonel kalp.</p>
  <ul>
    <li><strong>Nasıl Çalışır:</strong> Master veriler çekilir; rol ve filtrelere göre türetilir.</li>
    <li><strong>Periyot Seçenekleri:</strong> "Aylık" ve "Yıllık" görünümleri arasında geçiş yapılabilir.</li>
    <li><strong>Akıllı Filtreleme (Hiyerarşi):</strong> Bölge değişince Yönetmen ve Şehir listeleri otomatik daralır; tüm dashboard bileşenleri zincirleme güncellenir.</li>
    <li><strong>Önemli:</strong> Geri alma <em>silme değildir</em>.</li>
  </ul>

  <h3 id="mod-bayi-yoneticisi">bayi-yoneticisi</h3>
  <p><strong>Rol:</strong> Veri sağlığı kapısı.</p>
  <ul>
    <li><strong>Nasıl Çalışır:</strong> Bayi CRUD + Excel upsert.</li>
    <li><strong>Sorun Giderme:</strong> Denetimler görünmüyorsa bayiKodu tipleri kontrol edilir.</li>
  </ul>

  <h3 id="mod-soru-yoneticisi">soru-yoneticisi</h3>
  <p><strong>Rol:</strong> Şema ve migration yöneticisi.</p>
  <ul>
    <li><strong>Nasıl Çalışır:</strong> Sorular tek JSON (<code>fideQuestionsData</code>) olarak yönetilir.</li>
    <li><strong>Önemli:</strong> ID değişimi sadece migration senaryosu ile yapılır.</li>
  </ul>

  <h3 id="mod-eposta-taslagi">eposta-taslagi</h3>
  <p><strong>Rol:</strong> Bildirim içerik motoru.</p>
  <ul>
    <li><strong>Nasıl Çalışır:</strong> HTML şablonu Quill editörü ile düzenlenir.</li>
  </ul>

  <h3 id="mod-kullanici-yoneticisi">kullanici-yoneticisi</h3>
  <p><strong>Rol:</strong> Güvenlik merkezi.</p>
  <ul>
    <li><strong>Nasıl Çalışır:</strong> Kullanıcı CRUD, ban, cihaz yönetimi.</li>
    <li><strong>Stil Notu:</strong> Modül geçişlerindeki tasarım bozulmaları, JS'deki başlatma gecikmesi ile çözülmüştür.</li>
  </ul>

  <h3 id="mod-veritabani-yonetim">veritabani-yonetim</h3>
  <p><strong>Rol:</strong> Kurtarma ve yıkıcı işlemler.</p>
  <ul>
    <li><strong>Nasıl Çalışır:</strong> Çok adımlı onaylarla temizlik/sıfırlama yapılır.</li>
  </ul>
</section>

    </main>

</body>
</html>
SELF-CHECK RAPORU
- <!DOCTYPE html> mevcut mu? : EVET
- </html> mevcut mu? : EVET
- Toplam section sayısı (orijinal): 18
- Toplam section sayısı (çıktı): 18
- Section listesi birebir mi? : EVET
- Herhangi bir bölüm kısaltıldı mı? : HAYIR