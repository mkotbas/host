<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Profesyonel Bayi Planlayıcı - Cts İzin Modu</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: #f0f4f8;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 2rem;
        }

        /* Bilgilendirme Paneli */
        .info-banner {
            background: #fff;
            padding: 1rem 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 2rem;
            text-align: center;
            max-width: 800px;
            border-left: 5px solid #cc0000;
        }

        .info-banner p {
            color: #64748b;
            font-size: 0.95rem;
            margin-bottom: 0.5rem;
        }

        .calendar-container {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.5rem;
            max-width: 1200px;
            width: 100%;
        }

        .month-card {
            background: #ffffff;
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.05);
            padding: 1rem;
            transition: transform 0.2s ease;
        }

        .month-card:hover {
            transform: translateY(-5px);
        }

        /* Ay Özeti Kartı */
        .month-stats {
            background: #f8fafc;
            padding: 0.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: #475569;
            display: flex;
            justify-content: space-between;
            border: 1px solid #e2e8f0;
        }

        .stat-item span {
            display: block;
            font-weight: bold;
            color: #0f172a;
        }

        .month-header {
            text-align: center;
            font-size: 1.25rem;
            font-weight: 600;
            color: #fff;
            background: linear-gradient(to right, #ff7f7f, #cc0000);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }

        .weekdays-row {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.25rem;
            margin-bottom: 0.5rem;
        }

        .weekday {
            text-align: center;
            font-size: 0.85rem;
            font-weight: 500;
            color: #64748b;
            padding: 0.25rem;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
        }

        .day {
            text-align: center;
            padding: 0.75rem;
            border-radius: 8px;
            font-weight: 600;
            position: relative;
            transition: all 0.2s ease;
            background: #f8fafc;
            color: #94a3b8;
            user-select: none;
            font-size: 0.9rem;
        }

        /* Etkileşimli Günler (Pzt-Cts) */
        .day.interactive {
            cursor: pointer;
        }

        .day.interactive:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            border: 1px solid #cbd5e1;
        }

        /* Hafta İçi İş Günü */
        .day.workday {
            background: #f1f5f9;
            color: #475569;
        }

        /* Ziyaret Sayısı Stilleri */
        .day.three {
            background: #f59e0b;
            color: white;
            box-shadow: 0 2px 8px rgba(245,158,11,0.2);
        }

        .day.two {
            background: #10b981;
            color: white;
            box-shadow: 0 2px 8px rgba(16,185,129,0.2);
        }

        .day.one {
            background: #3b82f6;
            color: white;
        }

        /* İzinli Gün Stili */
        .day.leave {
            background: #ef4444 !important;
            color: white !important;
            opacity: 0.8;
            text-decoration: line-through;
        }

        /* Ziyaret Sayısı Rozeti */
        .visit-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #334155;
            color: #fff;
            font-size: 0.65rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #fff;
        }

        .day.leave .visit-badge {
            display: none;
        }

        .day.empty {
            visibility: hidden;
        }

        @media (max-width: 992px) {
            .calendar-container {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .calendar-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="info-banner">
        <p><strong>Güncelleme:</strong> Ziyaretler sadece <strong>Hafta İçi</strong> günlerine dağıtılır (Hedef: 47). Cumartesi günleri görev atanmaz ancak tıklayarak <strong>İzinli</strong> işaretleyebilirsiniz.</p>
        <p style="margin-top:0.5rem; font-size:0.85rem;">*Verileriniz tarayıcıda saklanır.</p>
    </div>

    <div class="calendar-container"></div>

    <script>
        const monthsTR = [
            'Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran',
            'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'
        ];

        const weekdaysTR = ['Pzt', 'Sal', 'Çar', 'Per', 'Cum', 'Cts', 'Paz'];

        class VisitPlanner {
            constructor(year) {
                this.year = year;
                this.calendarContainer = document.querySelector('.calendar-container');
                this.seed = year;
                this.leaveData = JSON.parse(localStorage.getItem('bayiPlanlayiciData')) || {};
            }

            saveData() {
                localStorage.setItem('bayiPlanlayiciData', JSON.stringify(this.leaveData));
            }

            toggleLeave(month, day) {
                const key = `${this.year}-${month}-${day}`;
                if (this.leaveData[key]) {
                    delete this.leaveData[key];
                } else {
                    this.leaveData[key] = true;
                }
                this.saveData();
                this.render();
            }

            // Sadece Hafta İçini Getir (İş ataması için)
            getWorkDays(month) {
                const days = [];
                const date = new Date(this.year, month, 1);
                
                while(date.getMonth() === month) {
                    const dayOfWeek = date.getDay(); 
                    // 0: Pazar, 6: Cumartesi. Sadece 1-5 arasını al.
                    if(dayOfWeek !== 0 && dayOfWeek !== 6) {
                        days.push(date.getDate());
                    }
                    date.setDate(date.getDate() + 1);
                }
                return days;
            }

            calculateMonthTarget(workDays, leaveDaysCount) {
                const baseTarget = 47; 
                if (workDays.length === 0) return 0;
                const dailyAverage = baseTarget / workDays.length;
                const deduction = Math.round(dailyAverage * leaveDaysCount);
                return Math.max(0, baseTarget - deduction);
            }

            calculateDistribution(activeWorkDays, targetVisits) {
                const daysCount = activeWorkDays.length;
                if (daysCount === 0) return { base: 0, extras: 0 };
                
                let basePerDay = Math.floor(targetVisits / daysCount);
                let remainder = targetVisits % daysCount;
                
                return { base: basePerDay, extras: remainder };
            }

            seededShuffle(array, seed) {
                let currentSeed = seed;
                const random = () => {
                    const x = Math.sin(currentSeed++) * 10000;
                    return x - Math.floor(x);
                };
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
                return array;
            }

            createMonthCalendar(month) {
                const allWorkDays = this.getWorkDays(month); // Sadece Pzt-Cum
                
                // İş günü olan günlerdeki izinleri say (Sadece bunlar hedefi düşürür)
                const activeWorkDays = [];
                let relevantLeaveCount = 0;

                allWorkDays.forEach(day => {
                    const key = `${this.year}-${month}-${day}`;
                    if (this.leaveData[key]) {
                        relevantLeaveCount++;
                    } else {
                        activeWorkDays.push(day);
                    }
                });

                const currentTarget = this.calculateMonthTarget(allWorkDays, relevantLeaveCount);
                const distribution = this.calculateDistribution(activeWorkDays, currentTarget);
                const monthSeed = this.seed + month + (currentTarget * 100);
                const shuffledDays = this.seededShuffle([...activeWorkDays], monthSeed);
                
                const plan = {};
                shuffledDays.forEach((day, index) => {
                    let visitCount = distribution.base;
                    if (index < distribution.extras) {
                        visitCount += 1;
                    }
                    plan[day] = visitCount;
                });

                // Sadece ekrandaki istatistik için toplam izin sayısını (Cts dahil) hesaplayalım
                let totalLeaveDisplay = 0;
                const daysInMonth = new Date(this.year, month + 1, 0).getDate();
                for(let d=1; d<=daysInMonth; d++) {
                    if(this.leaveData[`${this.year}-${month}-${d}`]) totalLeaveDisplay++;
                }

                return { plan, currentTarget, totalLeaveDisplay, totalWorkDays: allWorkDays.length };
            }

            render() {
                this.calendarContainer.innerHTML = '';
                
                for(let month = 0; month < 12; month++) {
                    const { plan, currentTarget, totalLeaveDisplay, totalWorkDays } = this.createMonthCalendar(month);
                    const firstDay = new Date(this.year, month, 1).getDay();
                    
                    const monthDiv = document.createElement('div');
                    monthDiv.className = 'month-card';
                    
                    const header = document.createElement('div');
                    header.className = 'month-header';
                    header.textContent = `${monthsTR[month]} ${this.year}`;

                    const stats = document.createElement('div');
                    stats.className = 'month-stats';
                    stats.innerHTML = `
                        <div class="stat-item">Hedef<span>${currentTarget}</span></div>
                        <div class="stat-item">İzin<span>${totalLeaveDisplay} Gün</span></div>
                        <div class="stat-item">Mesai<span>${totalWorkDays} Gün</span></div>
                    `;
                    
                    const weekdaysDiv = document.createElement('div');
                    weekdaysDiv.className = 'weekdays-row';
                    weekdaysTR.forEach(day => {
                        const dayDiv = document.createElement('div');
                        dayDiv.className = 'weekday';
                        dayDiv.textContent = day;
                        weekdaysDiv.appendChild(dayDiv);
                    });

                    const daysGrid = document.createElement('div');
                    daysGrid.className = 'days-grid';
                    
                    const emptyDays = (firstDay === 0 ? 6 : firstDay - 1);
                    for(let i = 0; i < emptyDays; i++) {
                        daysGrid.innerHTML += '<div class="day empty"></div>';
                    }

                    const totalDays = new Date(this.year, month + 1, 0).getDate();
                    
                    for(let day = 1; day <= totalDays; day++) {
                        const dayDiv = document.createElement('div');
                        dayDiv.className = 'day';
                        dayDiv.textContent = day;
                        
                        const date = new Date(this.year, month, day);
                        const dayOfWeek = date.getDay();
                        const isSunday = (dayOfWeek === 0);
                        const isSaturday = (dayOfWeek === 6);
                        const isLeave = this.leaveData[`${this.year}-${month}-${day}`];

                        // Pazar hariç herkes tıklanabilir
                        if(!isSunday) {
                            dayDiv.classList.add('interactive');
                            dayDiv.onclick = () => this.toggleLeave(month, day);

                            if (isLeave) {
                                dayDiv.classList.add('leave');
                                dayDiv.title = "İzinli";
                            } else {
                                // Eğer hafta içiyse iş yükünü göster
                                if (!isSaturday) {
                                    dayDiv.classList.add('workday');
                                    const count = plan[day] || 0;
                                    if(count >= 3) dayDiv.classList.add('three');
                                    if(count === 2) dayDiv.classList.add('two');
                                    if(count === 1) dayDiv.classList.add('one');
                                    
                                    if (count > 0) {
                                        const badge = document.createElement('span');
                                        badge.className = 'visit-badge';
                                        badge.textContent = count;
                                        dayDiv.appendChild(badge);
                                    }
                                }
                                // Cumartesi ise sadece tıklanabilir boş kutu kalır
                            }
                        }
                        
                        daysGrid.appendChild(dayDiv);
                    }

                    monthDiv.append(header, stats, weekdaysDiv, daysGrid);
                    this.calendarContainer.appendChild(monthDiv);
                }
            }
        }

        const currentYear = new Date().getFullYear();
        const planner = new VisitPlanner(currentYear);
        window.onload = () => planner.render();

    </script>
</body>
</html>